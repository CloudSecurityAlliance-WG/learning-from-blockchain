<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/7/anyswap-header.png"/></figure><br/><strong>The bridges are burning.</strong></p><p>AnySwap and <a href="https://www.rekt.news/chainswap-rekt/">Chainswap</a> in a 24 hour period.</p><p><strong>Anyswap were quick to <a href="https://twitter.com/AnyswapNetwork/status/1414248253822881793">announce</a> the incident.</strong></p><blockquote><p>An exploit was detected in the new anyswap v3 prototype, all bridge funds used in v1/v2 are safe.
Remedial action already in place for all exploited funds.</p></blockquote><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/7/anyswap-investigates.png"/></figure></p><p><strong>Attacker’s address:</strong> <a href="https://etherscan.io/address/0x0aE1554860E51844B61AE20823eF1268C3949f7C">0x0aE1554860E51844B61AE20823eF1268C3949f7C</a></p><p><strong>The funds lost were all $ pegged stablecoins totalling approximately $7.9M.</strong></p><p>Just over 5.5M $MIM were taken in <a href="https://etherscan.io/tx/0xecaaf8b57b6587412242fdc040bd6cc084077a07f4def24b4adae6fbe8254ae3">this</a> transaction.</p><p><em>A further 3 transactions saw a total of ~2.4M USDC stolen.</em></p><p><strong>1:</strong> <a href="https://etherscan.io/tx/0xc80e7cfeb16143cba4d5fb3b192b7dbe70e9bcd5ca0348facd20bf2d05693070">via Ethereum</a> - 1,536,821.7694 USDC</p><p><strong>2:</strong> <a href="https://bscscan.com/tx/0xa8a75905573cce1c6781a59a5d8bc7a8bfb6c8539ca298cbf507a292091ad4b5">via BSC</a> - 749,033.37 USDC</p><p><strong>3:</strong> <a href="https://ftmscan.com/tx/0x7312936a28b143d797b4860cf1d36ad2cc951fdbe0f04ddfeddae7499d8368f8">via Fantom</a> - 112,640.877101 USDC</p><p>The root of the exploit lay in the prototype V3 Router’s use of <a href="https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm">ECDSA</a>, the algorithm securing its MPC wallet by generating private keys.</p><p>The key here is that every k value calculated in the algorithm should be based on a different, random number for each signature. If two or more transactions contain a repeated k value, then the private key can be back-calculated.</p><p>This potential security flaw has been known since 2010, when console hacking group <a href="https://fail0verflow.com/blog/">fail0verflow</a> detailed the process <a href="https://web.archive.org/web/20150627235425/https://events.ccc.de/congress/2010/Fahrplan/attachments/1780_27c3_console_hacking_2010.pdf">here</a> (p123-129). And its application to blockchain keys was later detailed in <a href="https://web.archive.org/web/20160308014317/http://www.nilsschneider.net/2013/01/28/recovering-bitcoin-private-keys.html">2013</a>.</p><p>Credit: <a href="https://twitter.com/tayvano_/status/1414429115487117316?s=20">Tayvano</a></p><p>Despite this, Anyswap’s <a href="https://anyswap.medium.com/anyswap-multichain-router-v3-exploit-statement-6833f1b7e6fb">post-mortem</a> states that the attacker detected a repeated k value in two of the V3 Router’s transactions on BSC, and was able to back-calculate the private key.</p><p>Anyswap stressed that “only the new V3 cross-chain liquidity pools have been affected” and that the bridge remains operational via V1 and V2 Routers. The post-mortem also states that the V3’s code has been fixed and will reopen after the 48hr timelock installed by the team expires.</p><p><strong>The team has also reached out to potential bug bounty hunters:</strong></p><blockquote><p>Anyswap will reward anyone who reports bugs to us. This will help us build truly secure and even better cross-chain solutions.</p></blockquote><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/7/anyswap-linebreak.png"/></figure></p><p><strong>The need for fully secure bridges grows stronger by the day, as crypto capital spreads across multiple chains.</strong></p><p>However, the security architecture for cross-chain bridges is complex - proposing a puzzle to developers which has yet to be solved.</p><p><em>Anyswap V3 was a prototype, so perfection was not expected, but considering the nature of the exploit, it seems this loss was preventable.</em></p><p><strong>Although action was taken relatively quickly to prevent another attack, <a href="https://twitter.com/nicksdjohnson/status/1414512086672052238?s=20">@nicksdjohnson</a> is of the opinion that the patch does not do enough.</strong></p><blockquote><p>Setting aside the fact that there's a much better, industry standard solution to this, their patch:
Fails catastrophically (exposing users to another hack) if you accidentally delete a file, or restore from an old backup, or move to a new server.</p></blockquote><blockquote><p>And it requires every signature request to scan every previous one, but really that's the smallest problem here.</p></blockquote><p>Anyswap call themselves a “trustless protocol”, but perhaps that label no longer has the desired effect after such a damning evaluation from a leading Ethereum developer.</p><p><strong>Do you trust the <a href="https://github.com/anyswap/Anyswap-MPCNode/commit/31f94ff2c8fac19549f6c82b849977730f63bd63">Anyswap patch?</a></strong></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/04/second-conc2.png"/></figure></p>