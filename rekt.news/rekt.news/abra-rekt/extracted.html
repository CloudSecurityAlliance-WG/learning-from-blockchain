<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2023/01/abra-header.png"/></figure></p><p><em>Yesterday, some on-chain black magic led to two of Abracadabra’s cauldrons springing a leak.</em></p><p><strong>The lending platform was hacked for $6.5M on Ethereum, and Abra’s <a href="https://www.coingecko.com/en/coins/magic-internet-money">Magic Internet Money</a> didn't look so magic after all…</strong></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2023/01/abra-depeg.png"/></figure></p><p><a href="https://twitter.com/Phalcon_xyz/status/1752278614551216494">BlockSec</a> and <a href="https://twitter.com/peckshield/status/1752279373779194011">Peckshield</a> raised the alarm, with the former also <a href="https://twitter.com/BlockSecTeam/status/1752279348541841578">advising</a> users to withdraw their assets. An official <a href="https://twitter.com/MIM_Spell/status/1752286636740579440">acknowledgement</a> came shortly after, with the team promising to attempt to restore the MIM peg:</p><blockquote><p>To the best of its Ability, the DAO treasury will be buying back MIM from the market to then burn.</p></blockquote><p>Just over an hour after the attack began the issue had been mitigated, <a href="https://twitter.com/LickMyRomy/status/1752292772839588129">according</a> to an Abra team member. And the team’s efforts brought MIM back up to around $0.95.</p><p><strong>With the stablecoin <a href="https://www.coingecko.com/en/coins/magic-internet-money">currently</a> hovering around $0.97…</strong></p><p><em>…what dark arts will it take for MIM to fully repeg?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/09/rekt-investigates-linebreak.png"/></figure></p><p>Credit: <em><a href="https://twitter.com/MageIntern/status/1752319261908017632">Offside Labs</a>, <a href="https://twitter.com/EXVULSEC/status/1752357798783103158">EXVULSEC</a>, <a href="https://twitter.com/kankodu/status/1752581744803680680">Kankodu</a></em></p><p><strong>The <a href="https://twitter.com/MageIntern/status/1752319261908017632">root cause</a> of the exploit was, as <a href="https://twitter.com/qckhp/status/1752285931237740593">initially thought</a>, a rounding issue in the CauldronV4 code.</strong></p><p>The borrow function in CauldronV4 contracts was vulnerable to manipulation of the part parameter (the user’s share of total debt) via repeatedly borrowing and repaying an asset, taking advantage of the rounding error. For a more in-depth analysis, see <a href="https://twitter.com/kankodu/status/1752581744803680680">here</a>.</p><p><em>This allowed the attacker drain MIM liquidity from the <a href="https://etherscan.io/address/0x7259e152103756e1616A77Ae982353c3751A6a90">yvCrv3Crypto</a> and <a href="https://etherscan.io/address/0x692887E8877C6Dd31593cda44c382DB5b289B684">magicAPE</a> cauldrons, taking advantage of the incorrect debt calculation.</em></p><p><a href="https://twitter.com/EXVULSEC/status/1752357798783103158">Step-by-step</a>:</p><blockquote><p>1 Flashloan MIM token with Degenbox</p><p>2 Donate MIM token to BentoBox by depositing MIM token to BentoBox with recipient is BentoBox itself (this is a part of ERC-4626 first depositor attacker vector)</p><p>3 Repay liabilities for all other users by calling to <code>repayForAll()</code>. However the repayment is not complete such that the <code>elastic</code> value after the repayment is above a threshold <code>1000 * 1e18</code>. So the attacker needs to manually repay liabilities for other borrowers to decrease borrow elastic to zero</p><p>4 Repeatedly borrow and repay to inflate the share price. Here the vulnerability is well-known as ERC-4626 first depositor (or vault share price inflation)</p><p>5 Add collateral and borrow a large amount of MIM token</p><p>6 Repay flashloan and take profit</p></blockquote><p><strong>The resulting dump of the stolen MIM (for ETH) caused the depeg.</strong></p><p>Attacker address: <strong><a href="https://etherscan.io/address/0x87f585809ce79ae39a5fa0c7c96d0d159eb678c9">0x87f585809ce79ae39a5fa0c7c96d0d159eb678c9</a></strong></p><p>Attack tx 1 (10:14 UTC): <a href="https://etherscan.io/tx/0x26a83db7e28838dd9fee6fb7314ae58dcc6aee9a20bf224c386ff5e80f7e4cf2">0x26a83db7…</a></p><p>Attack tx 2 (10:26 UTC): <a href="https://etherscan.io/tx/0xdb4616b89ad82062787a4e924d520639791302476484b9a6eca5126f79b6d877">0xdb4616b8…</a></p><p>Exploited CauldronV4 contracts:</p><p>yvCrv3Crypto <a href="https://etherscan.io/address/0x7259e152103756e1616A77Ae982353c3751A6a90">0x7259e152103756e1616A77Ae982353c3751A6a90</a></p><p>magicAPE <a href="https://etherscan.io/address/0x692887E8877C6Dd31593cda44c382DB5b289B684">0x692887E8877C6Dd31593cda44c382DB5b289B684</a></p><p>Funds are currently held in two accumulation addresses: <a href="https://etherscan.io/address/0x40d5ffa20fc0df6be4d9991938daa54e6919c714">Exploiter address 2</a> ($4.2M) and <a href="https://etherscan.io/address/0xbd12d6054827ae3fc6d23b1acf47736691b52fd3">Exploiter address 3</a> ($2.2M). The Abracadabra team have <a href="https://etherscan.io/tx/0x66c7b94117b230d760d6cbed363cc057cbb81acd2dc8fcc0581e169ebb8adc7a">reached</a> <a href="https://etherscan.io/tx/0xa1f8e3c30917f33956ef0a96417987a07a70509a2e48b6426b65906462faad6b">out</a> on-chain in an attempt to open negotiations.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p>After a <a href="https://rekt.news/gamma-strategies-rekt/">busy</a> <a href="https://rekt.news/radiant-capital-rekt/">start</a> to January, and the <a href="https://rekt.news/etfgaffe/">chaotic</a> ETF approval announcements, the long-awaited TradFi-propelled market turnaround never materialised, and apathy seems to have taken over the timeline.</p><p><em>Now, a multimillion dollar exploit of one of the last bull run’s key players seems to have made little noise.</em></p><p><strong>Abracadabra’s Degenbox was a key part of the overleveraged Anchor play which eventually led to the <a href="https://rekt.news/luna-rekt/">collapse of LUNA/UST</a>, and co-founder Daniele Sesta is one of only a few of last cycle’s main characters that <em>hasn’t</em> ended up <a href="https://rekt.news/bulls-behind-bars/">behind bars</a>.</strong></p><p>A mix of populist calls to ‘Occupy DeFi’ and a talent for ponzi-pivoting saw Frog Nation projects propelled to enormous TVLs off relatively little innovation throughout 2021.</p><p><em>Even <a href="https://rekt.news/popsicle-rekt/">Popsicle</a> getting rekt for $20M and then Wonderland’s <a href="https://rekt.news/sifu-scandal/">Sifu scandal</a> didn’t seem to put the degens off.</em></p><p><strong>Yesterday’s hack comes just as new offerings are being <a href="https://twitter.com/danielesesta/status/1751553380693258326">teased</a>.</strong></p><p><em>A taste of things to come?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/rekt-outline-conc.png"/></figure></p>