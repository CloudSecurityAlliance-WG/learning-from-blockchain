<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/05/bunny-header.png"/></figure></p><p><strong>“Aren’t Flash loans Earitating” <a href="https://twitter.com/statelayer/status/1395267417832558596?s=20">said the hacker</a>.</strong></p><p><em>$45 million gone from Pancake Bunny Finance.</em></p><p>This was made possible due to a bug in the protocol that uses PancakeSwap to retrieve the prices of PancakeSwap liquidity providers (BNB-BUSDT / BNB-BUNNY)</p><p>8 flash loans were used to manipulate the price on various PancakeSwap pools, creating a skewed calculation of BUNNY from the VaultFliptoFlip vault.</p><p>This led to the minting of 697,000 BUNNY tokens, which were then sold, causing the price to drop from $146 to $6.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/05/bunny-price.png"/></figure></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/05/bunny-investigates.png"/></figure>
Credit: <a href="https://peckshield.medium.com/pancakebunny-incident-root-cause-analysis-7099f413cc9b">Peckshield</a></p><p><a href="https://bscscan.com/tx/0x897c2de73dd55d7701e1b69ffb3a17b0f4801ced88b0c75fe1551c5fcce6a979">BSCScan Transaction.</a></p><p><strong>Step 1:</strong> Take 8 different flashloans:</p><p><strong>The first seven flashloans are taken from various PancakeSwap pools while the last comes from Fortube Bank.</strong></p><p>1.05M WBNB from WBNB+CAKE pool</p><p>522.52K WBNB from WBNB+BUSD pool</p><p>210.16K WBNB from WBNB+ETH pool</p><p>133.50K WBNB from WBNB+BTCB pool</p><p>241.02K WBNB from WBNB+SAFEMOON pool</p><p>98.519K WBNB from WBNB+BELT pool</p><p>66.29K WBNB from WBNB+DOT pool</p><p>2.96M USDT from Fortube Bank.</p><p><strong>Step 2:</strong> Deposit 2.96M USDT and 7886 WBNB into WBNB+BUSDT pool as liquidity and mint 144.45K LP tokens.</p><p><strong>Step 3:</strong> Swap 2.32M WBNB for 3.83M BUSDT via the above WBNB+BUSDT pool so that the pool has a sufficiently large WBNB reserve, which is used to influence the valuation of the pool tokens.</p><p><strong>Step 4:</strong> Call getReward() to claim rewards from VaultFlipToFlip. With the higher LP token valuation, the attacker is able to claim a reward of 6.97M BUNNY (valued about $1+ B). Note the dev team gets separate 1.05M BUNNY.</p><p><strong>Step 5:</strong> Return the flashloans in Step 1 back to PancakeSwap pools and Fortube Bank.</p><p><strong>The attacker’s loot was initially held in this wallet:</strong> 0xa0acc61547f6bd066f7c9663c17a312b6ad7e187.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p><strong>At its peak, <a href="https://twitter.com/PancakeBunnyFin/status/1394932390590517249?s=20">Pancake Bunny</a> had over $10 billion in TVL.</strong></p><p>At the time of writing, that TVL is down to just over <a href="https://pancakebunny.finance/pool">$1 billion.</a></p><p>Even a <a href="https://github.com/PancakeBunny-finance/Bunny/blob/main/audits/[HAECHI%20AUDIT]%20PancakeBunny%20Smart%20Contract%20Audit%20Report%20ver%202.0.pdf">Haechi audit</a> couldn’t protect the Pancake Bunny from the awesome power of flash loan attack, earning them joint third position on the <a href="https://www.rekt.news/leaderboard/">rekt leaderboard.</a></p><p>Yesterday was a brutal day for all crypto markets, but BSC users in particular must have felt under fire, as <a href="https://twitter.com/VenusProtocol/status/1394892979190513664?s=20">Venus Protocol</a> and <a href="https://twitter.com/AltcoinPsycho/status/1394846317415911431?s=20">“wArOnrUgS”</a> imploded within hours of each other.</p><p><em>Loyal readers will have noticed that our anonymous author was unfortunately unavailable on such an eventful day.</em></p><p>We are always recruiting community members for our research and OPSEC departments.</p><p><strong>Will you help us in our quest to document corruption and exploitation in crypto and DeFi?</strong></p><p>If you have any suggestions or contributions towards our leaderboard or our content in general, please add to the <a href="https://github.com/RektHQ/leaderboard-metrics">rekt repo</a>, or contact us on <a href="https://twitter.com/RektHQ">Twitter</a>, <a href="https://t.me/Rekt_HQ">Telegram</a>, or via email using the address below.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-text-linebreak.png"/></figure></p><p><strong>EDIT - 18th July 2021.</strong></p><p>Haechi reached out to us with the following statement:</p><blockquote><p>We audited their smart contracts and published a report. This warned the fact that there are non-audited and changeable external contracts and the “helper” function is weak to flash loans’ attack. Pancake Bunny team upgraded their smart contracts and chose another auditing team for the updated contracts. This flash loan was caused by new smart contracts we did not audit.</p></blockquote><blockquote><p>You can find the details <a href="https://twitter.com/haechi_audit/status/1395583924575686656">here.</a></p></blockquote>