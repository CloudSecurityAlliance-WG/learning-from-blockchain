<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2022/10/transit-header.png"/></figure></p><p><em>Working on the weekend like usual…</em></p><p>Sunday morning notifications of a cross-chain protocol losing millions.</p><p>Just like the good old days.</p><p><strong><a href="https://transit.finance/">Transit Swap</a> has lost $21M to a vulnerability which allowed an unknown attacker to drain the wallets of users who had approved the protocol's swap contracts.</strong></p><p>But unfortunately for the hacker, over $1M was <a href="https://twitter.com/SlowMist_Team/status/1576488479357214721">lost in transit</a>… <em>not all MEV bots are <a href="https://rekt.news/ripmevbot/">down 0xbad</a> this week.</em></p><p>The team paused the affected contracts before <a href="https://twitter.com/TransitFinance/status/1576331732349222912">announcing the incident</a> on Twitter.</p><p>Then came an update that via “<em>the joint efforts of the <a href="https://twitter.com/SlowMist_Team">@SlowMist_Team</a>, the <a href="https://twitter.com/Bitrace_team">@Bitrace_Team</a>, the <a href="https://twitter.com/peckshield">@peckshield</a> security team,</em>” key info about the hacker, including their “<em>IP, email address, and associated on-chain addresses</em>” had been uncovered.</p><p>As the attacker’s anonymity began to slip away, it seems they had second thoughts. So far, over <a href="https://twitter.com/TransitFinance/status/1576463550557483008">70% of the funds</a> have been returned.</p><p><em>Finding a vulnerability in an unverified contract; diligent decompiler, or someone acting on insider info?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/09/rekt-investigates-linebreak.png"/></figure></p><p><strong>Though the vulnerability was in the project’s code, this attack targeted the users directly via a vulnerability in the use of the transferFrom() function. Any tokens approved for trading on Transit Swap could be transferred directly from users’ wallets to the unknown exploiter’s address.</strong></p><p>The first <a href="https://etherscan.io/tx/0xba75ad7a43e784f51fe777d749fc55ae10f1df2bcb01cde97641613b19acb6ec">attack tx</a> occurred just after 18:30 UTC, with the attack lasting approximately half an hour before swapping stolen tokens to ETH and BNB.</p><p><strong>Exploiter’s address on <a href="https://etherscan.io/address/0x75f2aba6a44580d7be2c4e42885d4a1917bffd46">ETH</a> and <a href="https://bscscan.com/address/0x75f2aba6a44580d7be2c4e42885d4a1917bffd46">BSC</a>:</strong> 0x75f2aba6a44580d7be2c4e42885d4a1917bffd46</p><p><strong>Vulnerable contract (revoke approvals on both ETH and BSC):</strong> 0xed1afc8c4604958c2f38a3408fa63b32e737c428</p><p><em>Credit: <a href="https://twitter.com/Supremacy_CA/status/1576332076277993475">Supremacy Inc.</a>, <a href="https://slowmist.medium.com/cross-chain-dex-aggregator-transit-swap-hacked-analysis-74ba39c22020">SlowMist</a></em></p><p>The project’s smart contracts are unverified. However, they can be decompiled from the published bytecode:</p><blockquote><p>After understanding the hacker's attack path, we tried to find out the cause of the vulnerability, but the smart contracts of the project are closed-source contracts. So we decompiled it and finally found the root cause of this attack: a controllable transferFrom external call</p></blockquote><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2022/10/transit-code.png"/></figure></p><blockquote><p>Because it is decompiled code, it is a little obscure for readers to understand. We can understand that varg0 is the token address, varg1, varg2 and varg3 are the from, to and amount parameters of the transferFrom function.</p><p>0x23b872dd in the figure is transferFrom() function signature of the function. Therefore, the claimTokens function calls the transferFrom function of an address, and the address and function parameters are controllable.</p></blockquote><p><strong>For a more detailed explanation, see <a href="https://slowmist.medium.com/cross-chain-dex-aggregator-transit-swap-hacked-analysis-74ba39c22020">SlowMist’s analysis</a>.</strong></p><p>Peckshield also provided a visual <a href="https://twitter.com/peckshield/status/1576419241414524929/photo/1">summary</a> of the attacker’s activities.</p><p>The returned funds have been consolidated into the same address (0xD989f7B4320c6e69ceA3d914444c19AB67D3a35E) on <a href="https://etherscan.io/address/0xD989f7B4320c6e69ceA3d914444c19AB67D3a35E">ETH</a> and <a href="https://bscscan.com/address/0xD989f7B4320c6e69ceA3d914444c19AB67D3a35E">BSC</a>, which holds a total of ~$16.5M across the two chains.</p><p><strong>Stolen funds:</strong></p><ul><li>3180 ETH ($4.2M), <a href="https://etherscan.io/tx/0x2e9d1f3ef02f1e3dc944b62976427a83f85ad280a42e6eb5b37bb366f6c017d8">returned</a>.</li><li>1500 Binance-pegged ETH ($2M), <a href="https://bscscan.com/tx/0x34e30dbfdeef6dcb3cb897e297de45e9e246b8c94c8a18b5ad4c4b776924ef0a">returned</a>.</li><li>50k BNB ($14M), <a href="https://bscscan.com/tx/0x0a6d27a3a6ef006760f5904c6f03b5e269b4615a1243cbe77e07d4f5bb83280a">$10.4M returned</a>.</li></ul><p><strong>At the time of writing, the exploiter’s <a href="https://bscscan.com/address/0x75f2aba6a44580d7be2c4e42885d4a1917bffd46">BSC address</a> still holds over $3.5M in stolen BNB and <a href="https://bscscan.com/txs?toaddress=0x0d5550d52428e7e3175bfc9550207e4ad3859b17&amp;address=0x75f2aba6a44580d7be2c4e42885d4a1917bffd46">previously sent 2500 BNB</a> ($715k) to Tornado Cash.</strong></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p>The fast response and cooperation between multiple security teams meant this incident had a happier ending than most.</p><p><strong>But a protocol using live, unverified contracts is never a good look in DeFi, where open-source is the name of the game.</strong></p><p>Hiding contract code makes DYOR all but impossible, and impedes the work of whitehats to spot vulnerabilities before they’re exploited.</p><p><strong>Closed-source code also breeds suspicion in the blockchain world, where <a href="https://rekt.news/leaderboard/">exploits, rug-pulls and “compromised keys”</a> are often forgotten within weeks.</strong></p><p><em>Could this be a case of an insider using privileged info against their users, before returning most of the funds and hoping it will all blow over?</em></p><p><em>Business as usual.</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/rekt-outline-conc.png"/></figure></p>