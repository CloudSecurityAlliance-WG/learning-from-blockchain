<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/12/grim-header.png"/></figure></p><p><strong>Don’t fear the reaper.</strong></p><p><em>Grim Finance is rekt.</em></p><p>The latest entry onto our <a href="https://rekt.news/leaderboard/">leaderboard</a> (#18), was a fork of <em>“Beefy Finance”</em>, offering auto-compounding LP vaults on Fantom.</p><p>After the attack, the project’s initial <a href="https://twitter.com/financegrim/status/1472357770846519312">announcement</a> referred to it as “<em>advanced</em>”, however reentrancy vulnerabilities are nothing new.</p><p><strong>The price of <a href="https://www.coingecko.com/en/coins/grimtoken">$GRIM</a> fell 80% after the attack.</strong></p><p><a href="https://twitter.com/ChargeDeFi/status/1472136494085296128">Charge DeFi</a> lost 1849 <a href="https://www.coingecko.com/en/coins/chargedefi-charge">$CHARGE</a> to the same attack vector just hours before…</p><p><em>Was this a serial attacker?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/09/rekt-investigates-linebreak.png"/></figure></p><p><em>Credit: <a href="https://twitter.com/RugDocIO/status/1472293717725913089">RugDoc</a></em></p><p><strong>The attack exploited a <em>depositFor()</em> function that hadn’t been protected against reentrancy.</strong></p><p>This allowed the hacker to loop additional false deposits within the initial call, vastly increasing their share of the vault.</p><p>As shown below, the user is able to choose the deposit token, which is where the attacker inserted their own contract containing the reentrancy deposit loops.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/12/grim-code.png"/></figure></p><p><em><a href="https://ftmscan.com/tx/0x19315e5b150d0a83e797203bb9c957ec1fa8a6f404f4f761d970cb29a74a5dd6">Example transaction</a> and workflow (Credit: <a href="https://threadreaderapp.com/thread/1472315936166219777.html">@k3mmio</a>):</em></p><p><strong>1)</strong> Grab a Flashloan for XXX &amp; YYY tokens (WBTC-FTM e.g.)</p><p><strong>2)</strong> Add liquidity on SpiritSwap</p><p><strong>3)</strong> Mint SPIRIT-LPs</p><p><strong>4)</strong> call depositFor() in GrimBoostVault with token==ATTACKER, user==ATTACKER</p><p><strong>5)</strong> Leverage token.safeTransferFrom for re-entrancy</p><p><strong>6)</strong> goto (4)</p><p><strong>7)</strong> In the last step on re-entrancy call depositFor() with token==SPIRIT-LP, user==ATTACKER</p><p><strong>8)</strong> Amount of minted GB-XXX-YYY tokens is increased in every level of re-entrancy</p><p><strong>9)</strong> Attacker ends up holding huge amount of GB-XXX-YYY tokens</p><p><strong>10)</strong> Withdraw GB tokens and get more SPIRIT-LP tokens back</p><p><strong>11)</strong> Remove liquidity and get more XXX and YYY tokens</p><p><strong>12)</strong> Repay Flashloan</p><p><strong>Attacker’s address:</strong> <a href="https://ftmscan.com/address/0xdefc385d7038f391eb0063c2f7c238cfb55b206c">0xdefc385d7038f391eb0063c2f7c238cfb55b206c</a></p><p><strong>The Grim Finance team has an ongoing investigation tracking the movement of funds across the attacker’s accounts, and have found links to various CEXs.</strong></p><p><em>Further details can be found in the rekt.news <a href="https://t.me/Rekt_HQ">Telegram group.</a></em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p><strong>Charge DeFi claims they <a href="https://twitter.com/ChargeDeFi/status/1472223355352895490">reached out</a> to projects who were using the same code in order to warn of the vulnerability.</strong></p><p>However, perhaps those messages didn’t have the desired effect. One Discord user tried to claim responsibility for the attack.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/12/grim-discord.png"/></figure></p><p><strong>If these messages are to be believed, then at least some of the $30 million stolen will be going to charity.</strong></p><p><em>But it will be a Grim Christmas for the unwilling donors.</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/rekt-outline-conc.png"/></figure></p>