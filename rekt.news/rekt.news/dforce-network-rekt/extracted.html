<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2023/01/dforce-header.png"/></figure></p><p><strong><a href="https://dforce.network/">dForce Network</a> was hit for $3.65M on both Arbitrum and Optimism.</strong></p><p>Shortly after 11pm Thursday night (UTC), an attack on two fronts exploited a common reentrancy vulnerability, netting $1.9M on Arbitrum and $1.7M on Optimism.</p><p>The <a href="https://twitter.com/ZoomerAnon/status/1623879348498432002">alarm was raised</a> a few hours later, and <a href="https://twitter.com/dForcenet/status/1623904209161830401">dForce confirmed</a> the incident after a further 90 minutes. The team then expanded on their original announcement, <a href="https://twitter.com/dForcenet/status/1623983550734163969">stating</a> that they had pause all vaults and adding:</p><blockquote><p>Users' funds supplied to dForce Lending and other vaults are SAFE.</p></blockquote><p>Good news came a few days later, when the exploiter <a href="https://twitter.com/dForcenet/status/1625004207395807232">returned</a> all funds to dForce multisigs.</p><p><strong>However, the read-only reentrancy vulnerability is well-known, having most recently affected <a href="https://rekt.news/midas-capital-rekt/">Midas Capital</a> and, before that, <a href="https://quillaudits.medium.com/decoding-220k-read-only-reentrancy-exploit-quillaudits-30871d728ad5">Market.xyz</a>.</strong></p><p>As we wrote in the Midas article:</p><blockquote><p>It’s always a shame to report on losses in DeFi, but especially when they are down to already known issues</p></blockquote><p><em>How much more will be lost to this bug?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/09/rekt-investigates-linebreak.png"/></figure></p><p>Credit: <em><a href="https://twitter.com/SlowMist_Team/status/1623956763598000129">SlowMist</a>, <a href="https://twitter.com/peckshield/status/1623910257033617408">Peckshield</a></em></p><p><strong>The exploit used flash loaned funds to deposit into Curve’s wstETH/ETH, depositing the LP tokens into dForce’s wstETHCRV-gauge vault.</strong></p><p>Upon calling the remove_liquidity function, the attacker’s contract exploited the reentrancy vulnerability to manipulate the virtual price, which dForce uses as an oracle for the wstETHCRV-gauge tokens.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2023/01/dforce-code.png"/></figure></p><p>This resulted in the hacker profiting off the liquidation of other users using wstETHCRV-gauge as collateral.</p><p>Exploiter’s address (<a href="https://optimistic.etherscan.io/address/0xe0d551017c0111ac11108641771897aa33b2817c">OP</a>, <a href="https://arbiscan.io/address/0xe0d551017c0111ac11108641771897aa33b2817c">ARBI</a>, <a href="https://etherscan.io/address/0xe0d551017c0111ac11108641771897aa33b2817c">ETH</a>): <strong>0xe0d551017c0111ac11108641771897aa33b2817c</strong></p><p>Attack tx OP: <a href="https://optimistic.etherscan.io/tx/0x6c19762186c9f32c81eb2a79420fc7ad4485aa916cab37ec278b216757bfba0d">0x6c197621…</a></p><p>Attack tx ARBI: <a href="https://arbiscan.io/tx/0x5db5c2400ab56db697b3cc9aa02a05deab658e1438ce2f8692ca009cc45171dd">0x5db5c240…</a></p><p><strong>The vulnerability has been well-known for some time. According to ChainSecurity’s <a href="https://chainsecurity.com/curve-lp-oracle-manipulation-post-mortem/">original report</a>:</strong></p><blockquote><p>On April 14, we informed Curve and affected projects about a read-only reentrancy vulnerability in some Curve pools. More specifically, the value of function get_virtual_price can be manipulated by reentering it during the removal of liquidity.”</p></blockquote><p>And Curve have <a href="https://twitter.com/CurveFinance/status/1614939752507244544">provided</a> a known workaround:</p><blockquote><p>one can call any method which has the nonreentrant lock (removing 0 liquidity is probably the cheapest).</p></blockquote><p>The attacker's ETH address was funded via Railgun on mainnet, before being used to fund OP and ARBI addresses via Synapse.</p><p>dForce sent transactions (<a href="https://optimistic.etherscan.io/tx/0xcca0c24c7156fcb9b8b4af19640c6d3897eb3ea4b322c268e3dd13a4eeb38b97">OP</a>, <a href="https://arbiscan.io/tx/0x0f43b40889bcfec6b5eef5802f9ae3cd8b881316e8bea98e6a015f06610cfac8">ARBI</a>) offering the attacker a bounty via tx input data.</p><p>Fortunately, the hacker responded days later.</p><p><strong>dForce <a href="https://twitter.com/dForcenet/status/1625004207395807232">announced</a> that funds had been returned to the project's multisigs and:</strong></p><blockquote><p>All impacted users will be made whole, we will announce the details for distribution of the funds over the next few days.</p></blockquote><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p><em>But this isn’t the first time dForce has got rekt.</em></p><p>Back before <a href="https://rekt.news/">rekt.news</a>, in what seems like the distant past of April 2020, <a href="https://cointelegraph.com/news/dforce-loses-9995-of-funds-in-latest-test-of-defi-resilience">dForce lost $25M</a> to an ERC-777 vulnerability. Users were <a href="https://twitter.com/dForcenet/status/1254738662039752704">reportedly refunded</a> days later.</p><p><strong>More recently, though, Layer 2 networks have been enjoying a boom in adoption.</strong></p><p>Of the most popular ETH L2s, Optimism is currently the only one with a token, and OP’s recent all time high is a sign of its growing popularity.</p><p><em>But with increased usage and higher TVL comes extra attention from those who seek to profit by any means necessary...</em></p><p><a href="https://rekt.news/airdrop-hunters/">Airdrop hunters</a> are <a href="https://rekt.news/airdrop-hunters2/">everywhere</a> and, although they may only stick around until they get what they came for, they are generally harmless.</p><p><strong>But speculators aren’t the only ones on the lookout for the next big thing.</strong></p><p>So far, we have covered <a href="https://rekt.news/wintermute-rekt/">relatively</a> <a href="https://rekt.news/lodestar-rekt/">few</a> <a href="https://rekt.news/treasure-dao-rekt/">incidents</a> on L2s, but we expect that to change as blackhats seek out new opportunities…</p><p><em>This won’t be the last L2 entry on our <a href="https://rekt.news/leaderboard/">leaderboard</a>.</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/rekt-outline-conc.png"/></figure></p>