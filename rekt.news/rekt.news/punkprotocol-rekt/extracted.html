<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/punk-header.png"/></figure></p><p><strong>Punk <em>is</em> dead.</strong></p><p>On Aug 10th, <a href="https://punk.finance/">Punk Protocol</a> was hacked for $8.95M, ~$5M of which was later returned.</p><p>The platform planned to offer a DeFi annuity scheme backed by ETH, WBTC and stablecoins.</p><p><em>Because there’s nothing more “Punk” than a pension plan.</em></p><p><strong>Luckily, a whitehat was able to frontrun the transactions and return over half of the funds.</strong></p><p><em>But not without taking a million dollars for themselves.</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/punk-investigates.png"/></figure></p><p><strong>The project planned to use a <a href="https://medium.com/punkprotocol/introducing-punk-protocol-fair-launch-be46ccbc8700">Fair Launch</a> to bring  $3M of deposits into 3 stablecoin pools: USDC, DAI and USDT.</strong></p><p>The <a href="https://medium.com/punkprotocol/punk-finance-fair-launch-incident-report-984d9e340eb">Punk post-mortem</a> details the vulnerability that led to the attack, and describes the root cause as a missing Modifier in the <strong>initialize()</strong> function within the <a href="https://github.com/PunkFinance/punk.protocol/blob/master/contracts/models/CompoundModel.sol">CompoundModel code</a>.</p><p>The hacker used <strong>delegateCall()</strong> to replace what should have been the protocol’s <strong>forgeAddress</strong> with their own <a href="https://etherscan.io/address/0x1695ce70da4521cb94dea036e6ebcf1e8a073ee6">malicious contract</a>, as a parameter of the CompoundModel’s <strong>initialize()</strong> function.</p><p>The lack of an “initializer” Modifier meant that the manipulated function was executed despite being associated with an unknown (and in this case malicious) contract.</p><p>With the contract address now updated, the attacker was then able to call <strong>withdrawToForge</strong>, sending the assets controlled by the CompoundModel directly to the malicious contract, and into their <a href="https://etherscan.io/txs?a=0x1d5a56402425c1099497c1ad715a6b56aaccb72b">wallet.</a></p><p>Although the withdrawal mechanisms are protected by the <strong>OnlyForge</strong> Modifier, the <strong>initialize()</strong> function had already defined the malicious contract as the <strong>forgeAddress</strong>, and as such <strong>OnlyForge</strong> did not detect any abnormality.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/punk-withdrawforge.png"/></figure></p><p>The stolen USDC was <a href="https://etherscan.io/tx/0x60c0757b82e82c9bb3e658d2d5a49e94630d04eb1bd735077ffed4e60e2403b5">swapped</a> to ETH via 1inch and then sent to TornadoCash in <a href="https://etherscan.io/tx/0x4dc506ec5e9de2bb4053de7fd6054176a51da5408752265c9c3058b53778718b">transactions</a> of 100 ETH each. The other assets were not swapped due to the whitehat intercepting them.</p><p>The hacker’s plan only paid off for one of the three pools however, as the owner of a frontrunning bot decided to put on their white hat upon noticing the transactions.</p><p>The saviour made their motives clear via <a href="https://etherscan.io/tx/0x4c8072a57869a908688795356777270a77f56ae47d8f1d869be0d25e807e03b1">tx input data</a>, and negotiations began via email.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/punk-frontran.png"/></figure></p><p><strong>Original attack tx:</strong><a href="https://etherscan.io/tx/0x7604c7dd6e9bcdba8bac277f1f8e7c1e4c6bb57afd4ddf6a16f629e8495a0281">0x7604c7dd6e9bcdba8bac277f1f8e7c1e4c6bb57afd4ddf6a16f629e8495a0281</a></p><p><strong>Whitehat frontrun tx:</strong> <a href="https://etherscan.io/tx/0x597d11c05563611cb4ad4ed4c57ca53bbe3b7d3fefc37d1ef0724ad58904742b">0x597d11c05563611cb4ad4ed4c57ca53bbe3b7d3fefc37d1ef0724ad58904742b</a></p><p><strong>However, the whitehat didn’t manage to stop all the funds from reaching the attacker:</strong></p><blockquote><p>Unfortunately, it looks like my frontrun was not perfect, as I did end up sending $3M USDC to the original hacker. Rewriting txs can be tricky.</p></blockquote><p>Following a <a href="https://medium.com/punkprotocol/punk-finance-fair-launch-incident-report-984d9e340eb">brief exchange</a> between the two, the Punk team managed to convince the whitehat that the incident had not been an inside job.</p><p>A bounty of $1M was decided by the protocol’s anonymous ally and after a halfhearted attempt to negotiate, the team eventually agreed, and the remaining ~$5M was returned.</p><p><strong>Approx $1.95M DAI:</strong> <a href="https://etherscan.io/tx/0x008dd92f8bcfcee400aed26d13495fbfc8351f9b21289792fc2bb9e771668147">0x008dd92f8bcfcee400aed26d13495fbfc8351f9b21289792fc2bb9e771668147</a></p><p><strong>Approx $3M USDT:</strong> <a href="https://etherscan.io/tx/0xace7c07695ec1bbf917486c3c81ee7de79c04e0309d4f6a149688463e6f83247">0xace7c07695ec1bbf917486c3c81ee7de79c04e0309d4f6a149688463e6f83247</a></p><p>Punk Protocol states that all <a href="https://etherscan.io/address/0xec36e96739b0fe73f5d078952850d1fc608e7652">recovered funds</a> will go towards compensation efforts for their users, and that they will release an update within the next few days.</p><p>The Punk team is also still <a href="https://twitter.com/PunkProtocol/status/1425391858524426242">hoping</a> for a change of heart from their attacker, although any amount of refund made would be insignificant compared to the previous day's events at <a href="https://www.rekt.news/polynetwork-rekt/">Poly Network.</a></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p><strong>Is a white hat white if they refuse to return part of the money they save?</strong></p><p>Although the anonymous actor only kept 16% of what was stolen, it was still worth $1M when they forced the deal onto Punk Protocol.</p><p>Something is better than nothing, and the Punk team have little reason to be angry at the whitehat, but that money could have gone back to its original owners...</p><p><em>Anti-heroes are everywhere in DeFi. It's white hat by day, and black by night.</em></p><p>Security auditor salaries are nothing compared to what they can earn by using their skills for themselves, and they're given the first and best opportunity to do so.</p><p><strong>Whitehats set their own wages, while security auditors take their salaries and the blame.</strong></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/punk-bollocks-tilit-noise.png"/></figure></p>