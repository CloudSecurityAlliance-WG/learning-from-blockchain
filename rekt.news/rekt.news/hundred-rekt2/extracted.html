<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2023/01/hundred-header.png"/></figure></p><p><strong>Hundred Finance finally gets its very own article.</strong></p><p><em>No sharing the spotlight this time…</em></p><p>Shortly after 2pm UTC on April 15th, Hundred Finance suffered a $7.4M exploit on Optimism.</p><p>The team’s <a href="https://twitter.com/HundredFinance/status/1647247792589471745">announcement</a> sounded more like a bystander’s observation than a protocol informing users of a multimillion dollar hack…</p><blockquote><p>It looks that Hundred got hacked on #Optimism. We will update when there is more information to it.</p></blockquote><p><em>But, then again, Hundred have been through all this before.</em></p><p>Last February, Hundred caught a stray to the tune of 3.3M when <a href="https://rekt.news/meter-rekt/">Meter got rekt</a>.</p><p>The following month saw Hundred’s <a href="https://rekt.news/agave-hundred-rekt/">leaderboard debut</a>, when $6.2M was lost on xDAI chain to a dual-edged attack which also hit Agave DAO for $5.5M.</p><p>That time, the attack vector was the same reentrancy mechanism which hit <a href="https://rekt.news/cream-rekt/">CREAM Finance</a> in August 2021.</p><p><strong>With Hundred’s leaderboard total now standing at $16.9M…</strong></p><p><em>…what was it this time?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/09/rekt-investigates-linebreak.png"/></figure></p><p>Credit: <em><a href="https://twitter.com/danielvf/status/1647329491788677121">Daniel Von Fange</a>, <a href="https://twitter.com/peckshield/status/1647307128267476992">Peckshield</a>, <a href="https://twitter.com/BeosinAlert/status/1647456363856134144">Beosin</a>, <a href="https://twitter.com/numencyber/status/1647530400028450816">Numen Cyber</a></em></p><p>Hundred is a Compound fork which uses hTokens to track lending positions. It was <a href="https://github.com/WhiteHatDAO/Smart-Contract-Security-Audits-by-White-Hat-DAO/blob/main/Audit_Report_Hundred_Finance%20(2).pdf">audited</a> in Feb 2022 by WhiteHatDAO.</p><p>As Daniel Von Fange <a href="https://twitter.com/danielvf/status/1647329491788677121">points out</a>:</p><blockquote><p>the project setup two wBTC cTokens, one of which was used by the UI, one of which was empty.</p></blockquote><p>Using a flashloan of WBTC from Aave, the attacker was able to donate large amounts of WBTC to the empty hWBTC contract, manipulating the exchange rate between hWBTC and WBTC. To top it off, the redeemUnderlying function contained a rounding error.</p><p>Attacker’s address (<a href="https://optimistic.etherscan.io/address/0x155da45d374a286d383839b1ef27567a15e67528">OP</a>, <a href="https://etherscan.io/address/0x155da45d374a286d383839b1ef27567a15e67528">ETH</a>): <strong>0x155da45d374a286d383839b1ef27567a15e67528</strong></p><p>Hack tx 1: <a href="https://optimistic.etherscan.io/tx/0x6e9ebcdebbabda04fa9f2e3bc21ea8b2e4fb4bf4f4670cb8483e2f0b2604f451">0x6e9ebcde…</a></p><p>Hack tx 2: <a href="https://optimistic.etherscan.io/tx/0x15096dc6a59cff26e0bd22eaf7e3a60125dcec687580383488b7b5dd2aceea93">0x15096dc6…</a></p><p><strong>Peckshield <a href="https://twitter.com/peckshield/status/1647307128267476992">summed up</a> the exploit as:</strong></p><blockquote><p>The root cause appears the attacker donates 200 WBTC to inflate hWBTC's exchange rate so that even a tiny amount (2 wei) of hWBTC can basically drain current lending pools.</p></blockquote><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2023/01/hundred-code.png"/></figure></p><p><strong>Beosin also <a href="https://twitter.com/BeosinAlert/status/1647456363856134144">provided</a> a step-by-step analysis:</strong></p><blockquote><p>The root cause is that the attacker can manipulate the exchangeRate by donating a large amount of WBTC to the hWBTC contract.</p><p>In the getAccountSnapshot function, the value of exchangeRateMantissa relies on the amount of WBTC in the contract.</p><p>The attacker flashloaned 500 $WBTC, then called the redeem function to redeem the previously staked 0.3 WBTC.</p><p>Next, the attack contract 1 sent 500.3 WBTC to attack contract 2. Contract 2 used 4 BTC to mint 200 hWBTC. The redeem function was then called to redeem the 4 BTC.</p><p>Here the attacker can redeem the 4 WBTC previously staked with less than 200 hWBTC. At this point the attacker had a very small amount of hWBTC left on contract 2.</p><p>Attack contract 2 then sent 500.3 WBTC to the hWBTC contract and borrowed 1021.91 ETH via the remaining 2 hWBTCs.</p><p>Finally the attack contract 2 repaid the previous debt by using 1 hWBTC, and withdrew 500.3 WBTC from the contract.</p></blockquote><p>The attacker bridged most of the <a href="https://twitter.com/PeckShieldAlert/status/1647802990160662531">stolen funds</a> to ETH where centralised stables USDT and USDC were swapped, or deposited into Curve.</p><p><strong>At the time of writing, the hacker’s <a href="https://debank.com/profile/0x155da45d374a286d383839b1ef27567a15e67528">debank profile</a> shows approximately $5.4M of assets on Ethereum and $0.9M remaining on Optimism.</strong></p><p>The price of <a href="https://www.coingecko.com/en/coins/hundred-finance">HND token</a> dropped around 50% over the day following the hack. It has since recovered somewhat, to ~$0.025, down from ~$0.039 before the attack.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p><strong>As we wrote <a href="https://rekt.news/agave-hundred-rekt/">last time</a>:</strong></p><blockquote><p>Forks upon forks create a house of cards. If the code is copied and pasted, vulnerabilities can open up where they're least expected.</p><p>When one fork falls, all others have to check their foundations.</p></blockquote><p><strong>Hundred have advised other COMP forks to get in touch, <a href="https://twitter.com/HundredFinance/status/1647634154710769664">warning</a> that the hack exploited “<em>a general flaw in the code and not specific to Hundred deployment</em>”.</strong></p><p>Likely spurred on by <a href="https://rekt.news/euler-rekt/">Euler Finance</a>’s recent success, the Hundred team have <a href="https://twitter.com/HundredFinance/status/1647995836117180416">announced</a> a reward for info leading to identification of the hacker:</p><blockquote><p>48h passed since we sent an on-chain message to the hacker and tried to start negotiations with him.</p><p>Today we are launching a $500k reward in the hope that this provides additional incentive for info that leads to the Hundred attacker’s arrest and the return of all funds.</p></blockquote><p>Hopefully the added pressure is as effective in recovering the funds…</p><p><em>Will Hundred get lucky?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/rekt-outline-conc.png"/></figure></p>