<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2022/05/mirror-header.png"/></figure>
<strong>Mirror mirror on the wall…</strong></p><p><strong>$90 million stolen, but that’s not all.</strong></p><p><em>Two exploits hit Mirror Protocol, and the larger of the two wasn’t even noticed at first.</em></p><p>When the <a href="https://rekt.news/ronin-rekt/">Ronin Bridge hack</a> was announced, we were all shocked to hear the funds were missing for a week before the alarm was raised.</p><p>It took Mirror Protocol <em>seven months,</em> to spot the loss, and when they did finally notice, they didn’t publicly announce anything.</p><p>And then, 232 days later, they were hit again.</p><p>The day after the first loss was revealed, another $2M was taken.</p><p><strong>How embarrassing.</strong></p><p><em>Mirror devs need to take a long hard look in the…</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/09/rekt-investigates-linebreak.png"/></figure></p><p><em>Credit: <a href="https://twitter.com/FatManTerra/status/1529978941062139906">FatManTerra</a>, <a href="https://twitter.com/FatManTerra/status/1529978941062139906">pedroexplore1</a></em></p><p>The first exploit, executed on the 8th of October 2021, involved repeatedly unlocking collateral deposited against short positions on Mirror Protocol.</p><p>The <a href="https://github.com/Mirror-Protocol/mirror-contracts/blob/main/contracts/mirror_lock/src/contract.rs">lock contract</a> did not contain a duplicate call check for withdrawals, allowing the attacker to drain funds deposited by other users by calling <em>unlock_position_funds</em> for their own position ID multiple times.</p><p><strong>Attack transaction:</strong> <a href="https://finder.terra.money/classic/tx/08DD2B70F6C2335D966342C20C1E495FD7A8872310B80BAF3450B942F79EBC1F">08DD2B70…</a></p><p><em>For a step-by-step analysis see this <a href="https://blocksecteam.medium.com/how-the-mirror-protocol-is-exploited-33b5c1d48322">BlockSec blog post</a>.</em></p><p>Despite the vulnerability remaining live, <a href="https://twitter.com/pedroexplore1/status/1530286785565171712">no followup</a> attack was made; the balance of the lock contract never rose high enough to exploit again without alerting the protocol’s userbase.</p><p>As FatManTerra <a href="https://twitter.com/FatManTerra/status/1529978968643981313">pointed out</a> on Twitter:</p><blockquote><p>”All of this went completely unnoticed by TFL and the Mirror team &amp; community.”</p></blockquote><p>On the 14th of May, the vulnerability was finally, and quietly, <a href="https://github.com/Mirror-Protocol/mirror-contracts/commit/56cc6946b9457293ede6aa0feb296ee1d16f6974?diff=split">patched</a> with no mention of the bug nor the $90M loss it had produced just seven months earlier.</p><p>Suspicions were raised when users on the forum began to look into the bugfix, provoking a <a href="https://forum.mirror.finance/t/was-there-a-security-hole-in-the-lock-contract/3390">discussion</a> as to why the devs had “smuggled” in the fix without an announcement.</p><p>Eventually, the details were <a href="https://twitter.com/FatManTerra/status/1529978941062139906">published</a> by FatMan on 27th May.</p><p>However, the day after the news of the original incident broke, the latest exploit was spotted.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p><strong>Mirror Hack Two: LUNA Switcheroo</strong></p><p><em>Source: <a href="https://forum.mirror.finance/t/another-exploit/3511">Mirroruser</a>, <a href="https://twitter.com/blockpane/status/1531369644531101696">Blockpane</a>, <a href="https://twitter.com/fatmanterra/status/1531365988809293825">FatManTerra</a></em></p><p>“Mirroruser” first <a href="https://forum.mirror.finance/t/another-exploit/3511">posted</a> the details to the Mirror forum, alerting the community to the loss of funds.</p><p>Due to the same mispricing of LUNC that led to the Anchor <a href="https://twitter.com/vic_vae/status/1530640035116113920">exploit</a>, LUNC was assigned the value of LUNA 2.0 on the new chain, at the time ~5 USTC (approx. ~$0.10).</p><p>The issue was down to Luna Classic validators <a href="https://twitter.com/blockpane/status/1531369644531101696">running an out-of-date oracle</a>, which hadn’t been updated for the legacy chain.</p><p>This meant that users could buy cheap LUNC, deposit as collateral, and take advantage of the overvaluation to drain Mirror’s pools. The protocol’s mBTC, mETH, mDOT and mGLXY were drained, totalling ~$2M for the attacker.</p><p>After news of the exploit over the weekend, the oracle was successfully fixed, but the problems didn't stop there.</p><p>All mAssets (Mirror-wrapped stocks) were still for the taking, unable to be traded until markets opened following the long-weekend. The worry was that the previously stolen funds would be used to snap up the remaining, <a href="https://twitter.com/FatManTerra/status/1531544246792118272">vastly-undervalued</a> mAssets.</p><p>However, with just minutes to spare before markets opened on Tuesday, the stolen funds were disabled for use as collateral, saving what remained of the protocol.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p><strong>The fact that a $90M exploit went unnoticed by users (and probably the devs), is symptomatic of the recklessness associated with the failings around the Terra ecosystem.</strong></p><p>The simplicity of the vulnerabilities seems out of place when compared with the damage that has been done. Firstly, $90M was lost to a basic logic bug, and then, the rushed fork led to the oversight of a very <a href="https://twitter.com/ChainLinkGod/status/1531384782046711808">foreseeable</a> oracle issue.</p><p><strong>Even in the face of these failures, <a href="https://www.youtube.com/watch?v=HJzwEi9iJsc">Luna 2.0 is pumping</a> and, despite having lost billions of dollars of other people's money, Do Kwon remains as <a href="https://twitter.com/Tree_of_Alpha/status/1530851485889724416">arrogant</a> as ever.</strong></p><p>In his rush to repair his reputation, Kwon is taking advantage of all those who are stuck fighting sunk-costs; the developers who invested their time, and retail, who invested their savings.</p><p><strong>DeFi today feels like it has lost a sense of purpose. Our reputation is damaged, and even the keenest users have less confidence.</strong></p><p>We may have advanced our methods of wealth distribution, but our moral compass clearly still needs an update.</p><p><em>Imagine our industry without all the ego… How much of this damage could have been prevented?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/rekt-outline-conc.png"/></figure></p>