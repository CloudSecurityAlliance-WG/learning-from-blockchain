<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/10/Index-Header.png"/></figure>
<strong>$16 million taken from Indexed Finance.</strong></p><p><em>That’s one more protocol added to the rekt register, and $16 million more on our <a href="https://rekt.news/leaderboard/">leaderboard.</a></em></p><p>We’ll always bring our stories to <a href="https://twitter.com/RektHQ">Twitter</a>, but if you want to talk directly to the characters involved, then the best place for you is the <a href="https://t.me/Rekt_HQ">rekt.news Telegram group.</a></p><p>Shortly after the attack, Indexed Finance core contributor and rekt reader <a href="https://twitter.com/laurence_e_day">Dr Laurence Day</a> showed the rekt group members as he tried to communicate with the hacker <a href="https://etherscan.io/tx/0x50af8eb95eeebf2ceb8e5a141841ad5bde7ddcc0bdc206ad761322cb26e4ec75">on-chain;</a></p><blockquote><p>Indexed Finance here.</p></blockquote><blockquote><p>Time to talk?</p></blockquote><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/09/rekt-investigates-linebreak.png"/></figure></p><p><strong><a href="https://indexed.finance/">Indexed Finance</a> offers investors 6 indices, each one a pool of various assets. Each index pool has its own token whose price <em>should</em> be a weighted average of the underlying assets.</strong></p><p>At 18:37 UTC on October 14th, an attack took place targeting the <a href="https://www.coingecko.com/en/coins/defi-top-5-index">DEFI5</a> and <a href="https://www.coingecko.com/en/coins/cryptocurrency-top-10-index">CC10</a> pools. The “Future of Finance Fund” <a href="https://www.coingecko.com/en/coins/future-of-finance-fund">(FFF)</a> was also heavily affected, given that DEFI5 and CC10 tokens make up 37.05% of its underlying assets.</p><p><em>More details of the exploit can be found in the <a href="https://ndxfi.medium.com/indexed-attack-post-mortem-b006094f0bdc">official post-mortem</a> as well as in <a href="https://twitter.com/Mudit__Gupta/status/1448884940964188167">Mudit Gupta’s twitter thread</a>.</em></p><p><strong>Dillon Kellar; the sole developer responsible for writing the original code of Indexed Finance, has made his thoughts public in a <a href="https://twitter.com/d1ll0nk/status/1448856748467630085">Tweet thread.</a></strong></p><p>The code governing the index pools is forked from the <a href="https://github.com/balancer-labs/balancer-core/blob/master/contracts/BPool.sol">Balancer Pool contract</a>. This allows for the internal rebalancing of assets within the pool on a constant product curve.</p><p>The function <em>extrapolatePoolValueFromToken</em> is based on the <em>“first token in the pool with a target weight over 0 and which is fully initialized”</em> to calculate the total value of the pool.</p><blockquote><p>total_value = token_balance * total_weight / token_weight</p></blockquote><p><strong>In order to control slippage, the rate at which the resulting changes in weights are enacted within the pool is <a href="https://docs.indexed.finance/index-pool-protocol/index">limited</a>, creating a temporary discrepancy ripe for manipulation.</strong></p><p><strong>The attacker’s address was funded via Tornado Cash hours before the attack:</strong>
<a href="https://etherscan.io/address/0xba5ed1488be60ba2facc6b66c6d6f0befba22ebe">0xba5ed1488be60ba2facc6b66c6d6f0befba22ebe</a></p><p><em>Both the DEFI and CC10 pools were attacked in the same way, see <a href="https://etherscan.io/tx/0x44aad3b853866468161735496a5d9cc961ce5aa872924c5d78673076b1cd95aa">this transaction</a> for the attack on the DEFI5 pool.</em></p><p>The attacker was able to take advantage of the above by using flash loans of the other assets in the pool to buy out UNI, decreasing the extrapolated value due to the delay in updating UNI’s weight decrease.</p><p>This was done gradually, as the <em>“pool does not allow swaps to send more than 1/2 of the pool’s existing balance in a token or purchase more than 1/3 of the pool’s balance in a token”.</em></p><p>After calling the <em>updateMinimumBalance</em> function using the gamed pool value, the controller valued the pool at just 29,851 SUSHI (~$300k), <em>“despite the pool having received over a hundred million dollars worth of other assets”.</em></p><p>Once prepared, the attacker could deposit relatively small amounts of (now heavily over-weighted) SUSHI into the pool, minting a massively inflated number of DEFI5 tokens in return.</p><p><strong>These were subsequently cashed out for the assets in the pool.</strong></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/10/Index-assets.png"/></figure></p><p>In total, about $16M of a variety of assets were stolen by the attacker, at the time of writing they remain in <a href="https://etherscan.io/address/0xba5ed1488be60ba2facc6b66c6d6f0befba22ebe">this address.</a></p><p><strong>In a follow up to the official post-mortem, <a href="https://twitter.com/laurence_e_day/status/1449036388209512457?s=20">Doctor Day has put out a statement:</a></strong></p><blockquote><p>The knife twist is that we've realised that we believe that we actually know who did this: we spoke to them quite a bit prior to the execution of this attack.</p></blockquote><blockquote><p>Starting on the 15th of September, we were approached by a Discord user under the name 'UmbralUpsilon' (currently BogHolder#1688), asking some questions about the way in which certain parameters were utilised in the oracle. Since every component of Indexed is open-source, we answered these questions, and upon asking the reason, were told that they were attempting to create an arbitrage bot for the pools.</p></blockquote><blockquote><p>This is a key part of how Indexed generates revenue (exit fees on burns when arbitraging the NAV of tokens and their value on DEXes), and we were happy to engage with queries about the mechanics, explaining how reindexes work, the timing of reweights, how tokens are added and removed from candidate asset lists, and so on. We had no reason to be alarmed: all of these conversations were in the spirit of open-source collaboration.</p></blockquote><blockquote><p>We are aware (courtesy of <a href="https://twitter.com/pcaversaccio">@pcaversaccio</a>) that the exploiter requested some Kovan testnet Ether via Gitter, using the (dead, presumably created for the purposes of the assault) Twitter account @ZetaZeroes. We have reached out to them via Gitter with the <a href="https://imgur.com/a/rhUHQY2">following message</a>.</p></blockquote><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/10/Index-zeta.png"/></figure></p><blockquote><p><strong>We speak now directly to the exploiter, if they ever read this: you’re clearly incredibly skilled: this is something that has been overlooked for ten months in production, and you’re the only one that found it. While it would have been so much more productive for you to instead choose to work with us: be the antihero of this story rather than the villain. Take a 10% whitehat, and save a lot of people the effort of engaging law enforcement.</strong></p></blockquote><blockquote><p>The people that are affected by this are those that are trying to diversify risk within a volatile space. That’s part of what makes this particularly cruel: no one deserves to have their funds whisked away, but the context here is an irony that can’t be ignored.</p></blockquote><blockquote><p>Our door’s open, and it’ll make a much more satisfying footnote to our appearance on rekt.news.</p></blockquote><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p><strong>Wise words from the Doxxed Doctor, who’s been put in the hot seat through no fault of his own.</strong></p><p>The damage dealt by these attackers is not just financial.</p><p>No DeFi developer should have to receive <a href="https://twitter.com/laurence_e_day/status/1448809966614290436?s=20">death threats.</a></p><p><em>Is anonymity the only way to stay safe?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-text-linebreak.png"/></figure></p>