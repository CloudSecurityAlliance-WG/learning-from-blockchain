<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2022/07/audius-header.png"/></figure></p><p><strong>Audius, web3’s answer to Spotify, has fallen victim to a governance attack, losing $6M of its native token, AUDIO.</strong></p><p>The attacker passed a malicious proposal transferring the funds directly from the treasury before dumping them onto the market for just ~$1M.</p><p><em>AUDIO is used for user rewards and artist tips, as well as for governance purposes on the music-streaming service.</em></p><p>Shortly after the <a href="https://twitter.com/spreekaway/status/1550995634899009536">alarm was raised</a>, Audius <a href="https://twitter.com/AudiusProject/status/1551000725169180672">announced</a> the “<em>unauthorized transfer</em>”, whilst asking for help with the investigation: “<em>If you'd like to help our response team, please reach out.</em>”</p><p><em>Pause, rewind, play…</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/09/rekt-investigates-linebreak.png"/></figure></p><p><em>Credit: <a href="https://blog.audius.co/article/audius-governance-takeover-post-mortem-7-23-22">Audius</a>, <a href="https://twitter.com/spreekaway/status/1551000138134556672">Spreek</a></em></p><p><strong>According to the official <a href="https://blog.audius.co/article/audius-governance-takeover-post-mortem-7-23-22">post mortem</a>, the attacker was able to reinitialise governance contracts, delegating a large number of governance tokens to themself and bypassing safeguards meant to limit malicious proposals.</strong></p><p><strong>Then, with their vastly increased voting power, they could pass a proposal to transfer 18M AUDIO tokens out of the treasury and straight to their own address.</strong></p><p>Audius uses <a href="https://github.com/AudiusProject/audius-protocol/blob/master/eth-contracts/contracts/AudiusAdminUpgradeabilityProxy.sol#L13">AudiusAdminUpgradabilityProxy</a> to make any upgrades to the governance contracts. The proxyAdmin address is set as the address of the main <a href="https://etherscan.io/address/0x4deca517d6817b6510798b7328f2314d3003abac#code">governance contract</a>, in storage slot 0.</p><p>However, this creates a collision with OpenZeppelin's <a href="https://github.com/OpenZeppelin/openzeppelin-sdk/blob/v2.8.0/packages/lib/contracts/Initializable.sol">Initializable contract</a>, leading to a bug which allowed the attacker to take control of the governance contract and change parameters on any of Audius’ Governance, Staking &amp; DelegateManagerV2 contracts.</p><p><em>For further details, see <a href="https://docs.openzeppelin.com/upgrades-plugins/1.x/proxies#unstructured-storage-proxies">OpenZeppelin docs</a> on storage collisions.</em></p><p><strong>The post mortem summarises the actions of the attacker as follows:</strong></p><blockquote><p>With this, the attacker was able to (1) Re-define voting on the Audius protocol and modify the governance contract’s guardian address (2) Set the governance address of both the Staking &amp; DelegateManagerV2 contracts to that of a custom deployment of the Audius governance contract 0xbdbb5945f252bc3466a319cdcc3ee8056bf2e569) and abuse the Audius protocol by</p><p>Mark an erroneous delegation of 10,000,000,000,000 $AUDIO to themselves in an attempt to pass a governance vote. (No circulating supply impact / confined to storage of Staking &amp; Delegation contracts)</p><p>Mark a second erroneous delegation of 10,000,000,000,000 $AUDIO to themselves in an attempt to pass a governance vote, which did pass and transferred the funds. (No circulating supply impact / confined to storage of Staking &amp; Delegation contracts)</p><p>Transferring 18,564,497 $AUDIO tokens from the community treasury: <a href="https://etherscan.io/tx/0x4227bca8ed4b8915c7eec0e14ad3748a88c4371d4176e716e8007249b9980dc9">https://etherscan.io/tx/0x4227bca8ed4b8915c7eec0e14ad3748a88c4371d4176e716e8007249b9980dc9</a></p></blockquote><p><strong>Attacker’s address:</strong> <a href="https://etherscan.io/address/0xa0c7BD318D69424603CBf91e9969870F21B8ab4c">0xa0c7BD318D69424603CBf91e9969870F21B8ab4c</a></p><p>The attacker then went on to dump the AUDIO in a <a href="https://etherscan.io/tx/0x82fc23992c7433fffad0e28a1b8d11211dc4377de83e88088d79f24f4a3f28b3">single transaction</a> via Uniswap v2, incurring major slippage and making off with just 704 ETH (~$1M).</p><p>The funds were then deposited into Tornado Cash around 10 hours later.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p>Despite the <a href="https://twitter.com/0xSisyphus/status/1550993262567198721">extreme price action</a> as the attacker dumped the loot, the price of <a href="https://www.coingecko.com/en/coins/audius">AUDIO</a> has held up well since the incident.</p><p>A quick response time from the team (plus <a href="https://twitter.com/AudiusProject/status/1551378752424161280">help</a>), and the loss coming from the treasury, rather than users pockets, likely minimised the fallout.</p><p>The contracts had been audited twice, by <a href="https://assets.website-files.com/6024b69839b1b755528798ea/6201872afb297b3955e303aa_Audius%20-%20Security%20Assessment%20for%20Audius%20Protocol%20v1.1.0.pdf">Kudelski</a> and <a href="https://blog.openzeppelin.com/audius-contracts-audit/">OpenZeppelin</a>, and the vulnerability is <a href="https://docs.openzeppelin.com/upgrades-plugins/1.x/proxies#unstructured-storage-proxies">a known issue</a>.</p><p>However, this doesn’t look to have knocked Audius off the DeFi playlist for good.</p><p><em>Let’s just hope their <a href="https://rekt.news/leaderboard/">debut</a> is a one-hit wonder.</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/rekt-outline-conc.png"/></figure></p>