<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2023/01/tornado-gov-header.png"/></figure></p><p><strong>Cypherpunks strive to become ungovernable…</strong></p><p><em>…but not like this.</em></p><p><strong>In a whirlwind of events, Tornado Cash's governance has been taken hostage via a trojan horse proposal, effectively granting control of the DAO to a single address.</strong></p><p>While the contracts do not allow for draining of the <a href="https://defillama.com/protocol/tornado-cash">~$275M</a> in the privacy pools themselves, the exploiter gained control of the TORN governance token, the power to modify the router to reroute deposits/withdrawals, and admin status over Nova, the Gnosis chain deployment.</p><p><em>However, it seems not all is lost.</em></p><p><strong>Yesterday, just before midday UTC, the exploiter <a href="https://etherscan.io/address/0x1FAd009aD35689B5a9B91486148F2F32AFE31e23">published</a> another proposal to revert the changes.</strong></p><p>As long as there are no nasty surprises this time, this could be a bullet dodged for the Tornado Cash community.</p><p><em>Repentant grey-hat?</em></p><p><em>Lazarus <a href="https://twitter.com/KyleSt4rgarden/status/1660396019946000384">intern</a>?</em></p><p><em>Or maybe the hacker is just looking to <a href="https://twitter.com/0xngmi/status/1660405878619611138">pump and dump</a> their remaining TORN?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/09/rekt-investigates-linebreak.png"/></figure></p><p>Credit: <em><a href="https://twitter.com/samczsun/status/1660012956632104960">samczsun</a>, <a href="https://twitter.com/SlowMist_Team/status/1660252800406659073">SlowMist</a>, <a href="https://twitter.com/BlockSecTeam/status/1660214665429876740">BlockSec</a>, <a href="https://twitter.com/apoorvlathey/status/1660355712353189888">Apoorv Lathey</a></em></p><p><strong>It’s been a tough year for DeFi’s go-to crypto mixer.</strong></p><p>From the <a href="https://rekt.news/eye-of-the-storm/">OFAC sanctions</a> levelled in August, and the <a href="https://rekt.news/winds-of-change/">jailing</a> of core developer, Alexey Pertsev, now <a href="https://twitter.com/alex_pertsev/status/1651961639388815363">released</a> pending trial.</p><p>Last week there were <a href="https://twitter.com/spreekaway/status/1659129830330310657">worries</a> that someone was attempting to exploit Tornado’s governance system, creating multiple addresses and locking 0 TORN to the governance vault. Given that nothing immediately came of it, it was <a href="https://forums.tornadocash.community/t/analysis-of-a-possible-attempt-at-a-failed-exploit/178">dismissed</a> as a failed attempt.</p><p><strong>Was it a decoy, perhaps?</strong></p><p><em>Or a preparatory move?</em></p><p>Exploiter address 1: <strong><a href="https://etherscan.io/address/0x092123663804f8801b9b086b03b98d706f77bd59">0x092123663804f8801b9b086b03b98d706f77bd59</a></strong></p><p>Exploiter address 2: <strong><a href="https://etherscan.io/address/0x592340957ebc9e4afb0e9af221d06fdddf789de9">0x592340957ebc9e4afb0e9af221d06fdddf789de9</a></strong></p><p>The successful attack was smuggled in under cover of a proposal to <a href="https://twitter.com/samczsun/status/1660012960176279552/photo/1">penalise certain ‘cheating’ relayers</a>. While the code purportedly used the same logic as a <a href="https://forums.tornadocash.community/t/16-relayer-registry-penalisation-and-configuration/129">previous proposal</a>, the attacker had added an <a href="https://twitter.com/samczsun/status/1660012960176279552/photo/2">extra function</a> which allowed them to selfDestruct the contract.</p><p>The <a href="https://etherscan.io/address/0xC503893b3e3c0C6b909222b45f2a3a259a52752D">proposal contract</a> itself was published via a deployer contract. By <a href="https://twitter.com/apoorvlathey/status/1660355712353189888">combining</a> CREATE and CREATE2 opcodes, the attacker could take advantage of their deterministic deployment to deploy new code into the address approved by governance.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2023/01/tornado-gov-contracts.png"/></figure></p><p>Using <a href="https://etherscan.io/tx/0xd3a570af795405e141988c48527a595434665089117473bc0389e83091391adb">selfDestruct</a>, the hacker was then able to erase the approved code, simultaneously resetting their nonce, and allowing for a redeployment of the malicious contract at the same address.</p><p>BlockSec’s Yajin Zhou <a href="https://twitter.com/yajinzhou/status/1660310706644721664">explains</a>:</p><blockquote><p>Option I: Use CREATE2 opcode to create a malicious proposal contract. This will raise a flag since CREATE2 and self-destruct are used together.</p><p>Option II: Use CREATE2 to create the deployer contract (0x7dc8), which further deploys the malicious proposal contract (0xc503) using CREATE.</p><p>Then the deployer contract is self-destructed (to reset the nonce), and it can create a new proposal at the same address (0xc503).</p><p>4/ That's because the address of the deployed contract using CREATE depends on the sender and nonce (nonce = 1), enabling the attacker to create a new proposal with the same address (0xc503)</p></blockquote><p><em>These techniques for creating ‘<a href="https://0age.medium.com/the-promise-and-the-peril-of-metamorphic-contracts-9eb8b8413c5e">metamorphic contracts</a>’ are one reason that some have <a href="https://hackmd.io/@vbuterin/selfdestruct">called for</a> the selfDestruct opcode to be deprecated.</em></p><p>The malicious proposal then assigned 10,000 TORN to all addresses created in last week’s (<em>presumed</em>) failed exploit. These were unlocked and <a href="https://twitter.com/samczsun/status/1660094606019825664">withdrawn</a> from the vault, granting the exploiter 1.2M votes (against 700k legitimate votes) and full control of Tornado governance.</p><p>See <a href="https://t.co/OHCCzl5RUY">BlockSec’s chart</a> for a full breakdown of the attack stages:</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2023/01/tornado-gov-flow.png"/></figure></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p><strong>In unexpected turn of events, the exploiter later <a href="https://etherscan.io/address/0x1FAd009aD35689B5a9B91486148F2F32AFE31e23#code">published</a> a proposal to <a href="https://forums.tornadocash.community/t/attacker-has-a-new-proposal-to-potentially-restore-the-state-of-governance/183/">revert the effects</a> of their hostile takeover, handing back control to the DAO as before.</strong></p><p>Apart from the 430 ETH (~$750k) profit from dumping TORN (<em>any guesses where the attacker <a href="https://etherscan.io/address/0x092123663804f8801b9b086b03b98d706f77bd59?toaddress=0xd90e2f925da726b50c4ed8d0fb90ad053324f31b">chose to launder</a> the profits?</em>), the hacker may have <a href="https://twitter.com/0xdface/status/1660395508521738240">other motivations</a>:</p><blockquote><p>Either they're giga trolling or it will end up being an expensive but not disastrous lesson in Governance security.</p></blockquote><p>As community member Tornadosaurus-Hex <a href="https://forums.tornadocash.community/t/attacker-has-a-new-proposal-to-potentially-restore-the-state-of-governance/183/4">pointed out</a>:</p><blockquote><p>I mean note that we don’t even have a choice in regards to this proposal but it is still important nonetheless.</p></blockquote><p><strong>Hopefully, this devastating (albeit impressively crafted) exploit will have a happy ending.</strong></p><p>Should it have been spotted? <em>Maybe.</em></p><p>But with <a href="https://forums.tornadocash.community/t/18-audit-reimbursement-and-remuneration-q2/150">recent trouble</a> amongst <a href="https://twitter.com/deomaius/status/1649910369467473930">contributors</a>, perhaps the DAO was not at full strength.</p><p>The <a href="https://twitter.com/deomaius/status/1649910385305108489">warning</a> “<em>You will be at the helm of negligent tokenholders.</em>” reads as stunningly prescient, in hindsight.</p><p>However we got here, hopefully this all turns out to have been nothing more than a <em>storm in a teacup</em>.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/rekt-outline-conc.png"/></figure></p>