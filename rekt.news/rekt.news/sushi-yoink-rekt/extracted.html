<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2023/01/sushi-yoink-header.png"/></figure></p><p><em>Yoink.</em></p><p><strong>Over $3.3M was stolen from <a href="https://twitter.com/SushiSwap">SushiSwap</a> users over the weekend via a new routing contract.</strong></p><p>All users who had approved Sushi’s 4 day old <a href="https://etherscan.io/address/0x044b75f554b886A065b9567891e45c79542d7357">RouteProcessor2 contract</a> at the time of the incident, were at risk, across <a href="https://gist.github.com/0xngmi/40c530a6dc219e62939ed911b5d5ac70">14 chains</a>.</p><p><strong>Sushi Head Chef, Jared Grey, <a href="https://twitter.com/jaredgrey/status/1644914375151550464">acknowledged</a> the bug, urging users to revoke approvals. He later <a href="https://twitter.com/jaredgrey/status/1645195713305878528">stated</a> that the protocol is now safe to use, and the exploited contract has been removed, as well as <a href="https://twitter.com/jaredgrey/status/1645109790425731075">promising</a> a full post-mortem on events.</strong></p><p><em>Amongst the chaos, <a href="https://rekt.news/sifu-scandal/">DeFi’s favourite villain</a> got <a href="https://twitter.com/peckshield/status/1644907207530774530">rekt</a> for 1800 ETH, and there was plenty of <a href="https://twitter.com/jaredgrey/status/1645065502748704769">whitehacking</a> <a href="https://twitter.com/_anishagnihotri/status/1645040757219250176">activity</a>.</em></p><p>One user <a href="https://twitter.com/trust__90/status/1644895249058131971">claimed</a> to have targeted 0xSifu as a whitehat, though the attempt appeared to have been <a href="https://twitter.com/trust__90/status/1644900643608358913">botched</a>, with only 100 ETH eventually <a href="https://twitter.com/0xSifu/status/1644996954093486080">returned</a>. <a href="https://twitter.com/BlockSecTeam/status/1644963756621852673">BlockSec</a> also got involved, adding to their impressive list of <a href="https://twitter.com/BlockSecTeam/status/1644971411260289031">recent whitehacks</a>.</p><p>Luckily, the days-old contract had relatively few approvers, and this didn’t turn out to be the AMM-ageddon it could have been.</p><p><strong>But this is a bad look for an already-embattled protocol, nonetheless.</strong></p><p><em>How many more <a href="https://rekt.news/sushiswap-scandal/">scandals</a> can Sushi take?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/09/rekt-investigates-linebreak.png"/></figure></p><p>Credit: <em><a href="https://twitter.com/InspexCo/status/1644966371149889538">Inspex</a>, <a href="https://twitter.com/0xfoobar/status/1645087636061577216">0xfoobar</a>, <a href="https://twitter.com/ernestognw/status/1645113066021965825">ernestognw</a></em></p><p>The new contract contained the function, processRoute, which is insufficiently protected against accepting arbitrary data.</p><p>The attacker was able to create a fake Univ3 pool, and insert their own contract address in place of a genuine liquidity pool. During the uniswapV3SwapCallback function, the contract is then able to drain (or <a href="https://twitter.com/cryptocojak/status/1644908746001494017">'yoink'</a>) tokens from any address which had approved it.</p><p>As 0xfoobar <a href="https://twitter.com/0xfoobar/status/1645087636061577216">explained</a>:</p><blockquote><p>SushiSwap router exploit comes from a bad callback. Although the line 328 comment is correct, line 340 does not check the pool deployer. So you can impersonate a V3Pool, do a no-op swap, call safeTransferFrom on an arbitrary ERC20 and arbitrary <code>from</code> address on line 347</p></blockquote><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2023/01/sushi-yoink-code.png"/></figure></p><p>A more <a href="https://twitter.com/ernestognw/status/1645113041430757378">detailed breakdown</a> was provided by ernestognw.eth.</p><p>Example attack tx: <a href="https://etherscan.io/tx/0xea3480f1f1d1f0b32283f8f282ce16403fe22ede35c0b71a732193e56c5c45e8">0xea3480f1…</a></p><p>RouteProcessor2 contract on ETH: <a href="https://etherscan.io/address/0x044b75f554b886A065b9567891e45c79542d7357">0x044b75f554b886A065b9567891e45c79542d7357</a></p><p><a href="https://gist.github.com/0xngmi/40c530a6dc219e62939ed911b5d5ac70">See this list for addresses to revoke across multiple chains.</a></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p><strong>Rather than an existential threat to SushiSwap, this incident is more of an embarrassment than anything.</strong></p><p>The damage wasn’t enourmous, nor <a href="https://dune.com/0xkhmer/sushiswap-exploit">particularly widespread</a>. Users were either <a href="https://twitter.com/geek_sg/status/1645048235860586496">drained or revoked</a> quickly, and whitehat efforts certainly helped to soften the PR blow.</p><p><em>Ever since its launch, though, Sushi has been surrounded by drama.</em></p><p>2020’s DeFi summer saw Sushi come onto the scene in dramatic fashion, quickly establishing itself as one of DeFi’s darlings, alongside Uniswap, Curve, Aave and Compound.</p><p><strong>However, a period of stagnation during the 2021 bull run ended in <a href="https://rekt.news/sushiswap-scandal/">infighting</a>. Then, in October, the new head chef, Jared Grey’s, <a href="https://rekt.news/sushiswap-grey-area/">murky past</a> in a variety of struggling projects drew suspicion.</strong></p><p>Sushi seems to be a good case study for DAOs working, until they don’t.</p><p>A small team of highly-motivated devs can disrupt the DEX landscape in just weeks. But once the excitement wanes, a bloated team can get too comfortable with inactivity and apathy (or simply farming a project’s treasury).</p><p>Grey <a href="https://forum.sushi.com/t/head-chef-jared-greys-official-sec-statement-faq/11918">receiving</a> an SEC subpoena, <a href="https://twitter.com/0xriptide/status/1645106409594314752">criticism</a> of a paltry bug bounty programme, and large <a href="https://twitter.com/jaredgrey/status/1602701300520652800">operating expenses</a> (including 500k for Grey himself)...</p><p><em>It appears the <a href="https://forum.sushi.com/t/remove-jared-grey-as-head-chef/11892">drama</a> is far from over for Sushi.</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/rekt-outline-conc.png"/></figure></p>