<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/7/thor-header.png"/></figure>
<strong>Even the old gods cannot escape the exploits.</strong></p><p>As the cross-chain attacks continue, THORChain becomes the latest victim.</p><p><strong>$5 million taken in various assets from the recently updated THORChain Bifrost bridge code.</strong></p><p>Cronje wrote that <a href="https://twitter.com/AndreCronjeTech/status/1415909394643132417?s=20">innovation leads to exploitation</a>, but as attacks are so common, it seems that so does <a href="https://www.rekt.news/saddle-finance-rekt/">replication</a>, or even <a href="https://www.rekt.news/shitcoins/">slight alteration</a>.</p><p>The number of names listed on our <a href="https://www.rekt.news/leaderboard/">leaderboard</a> is steadily rising, and these are not all fast forks or cheap copy-paste protocols.</p><p>THORChain has a dedicated user base, and their peak market cap reached <a href="https://www.coingecko.com/en/coins/thorchain">nearly $5 billion</a> just two months ago (now at $1.2B).</p><p><em>How can such an established platform still fall victim to an anonymous attacker?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/7/thor-investigates.png"/></figure></p><p><strong>Attacker Wallet:</strong> <a href="https://etherscan.io/address/0x3a196410a0f5facd08fd7880a4b8551cd085c031">0x3a196410a0f5facd08fd7880a4b8551cd085c031</a></p><p><strong>Contract Address:</strong> <a href="https://etherscan.io/address/0x4a33862042d004d3fc45e284e1aafa05b48e3c9c">0x4a33862042d004d3fc45e284e1aafa05b48e3c9c</a></p><p><strong>Tornado Address:</strong> <a href="https://etherscan.io/address/0x4b713980d60b4994e0aa298a66805ec0d35ebc5a">0x4b713980d60b4994e0aa298a66805ec0d35ebc5a</a></p><p>According to ThorChain’s preliminary <a href="https://thearchitect.notion.site/THORChain-Incident-07-15-7d205f91924e44a5b6499b6df5f6c210">incident report</a>, the bug was located within the ETH Bifrost (bridge) <a href="https://gitlab.com/thorchain/thornode/-/blob/develop/bifrost/pkg/chainclients/ethereum/ethereum_block_scanner.go#L794">code</a>.</p><p>The code contains an over-ride loop, designed only for use in <em>vaultTransferEvent</em> transactions, which the hacker was able to manipulate. The hacker was able to wrap the router with their own <a href="https://etherscan.io/address/0x4a33862042d004d3fc45e284e1aafa05b48e3c9c">contract</a>, allowing them to access this over-ride.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/7/thor-code.png"/></figure></p><p>A transaction was sent with call value of 0 and deposit amount of 0. However, the over-ride loop caused the transaction’s msg.value, set at 200, to be mistakenly read as the txvalue().</p><p><strong>The exploit was then used in a loop, draining liquidity in various coins:</strong></p><ul><li>2,500 ETH</li><li>57,975.33 SUSHI</li><li>8.7365 YFI</li><li>171,912.96 DODO</li><li>514.519 ALCX</li><li>1,167,216.739 KYL</li><li>13.30 AAVE</li></ul><p><strong>Although the code contains a comment that explicitly states...</strong></p><blockquote><p>”// it is important to keep this part outside the above loop”</p></blockquote><p>… the vulnerability was left open, and looks to have been a costly oversight for the ThorChain team.</p><p>According to the incident report:</p><blockquote><p>”The fix is to make the over-ride only happen if it specifically is a vaultTransferEvent”</p></blockquote><p><strong>It seems this is something that could have been foreseen and prevented long ago.</strong></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p><strong>Creating a secure cross-chain bridge is one of the most important milestones for the industry right now, and the race is on to be the first to provide it.</strong></p><p>As <a href="https://twitter.com/lemiscate/status/1414978778489659394?s=20">AAVE have hinted</a> that they will release something soon, it seems that this is a prize even the giants of DeFi cannot resist fighting for.</p><p><em>If innovation really does lead to exploitation, then there are many more stories yet to be told...</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-text-linebreak.png"/></figure></p>