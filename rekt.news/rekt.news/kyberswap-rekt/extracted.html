<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2023/01/kyberswap-header.png"/></figure></p><p><em>It’s already been a November to remember… and there’s still a week to go.</em></p><p><strong>OG decentralised exchange <a href="https://kyberswap.com/">KyberSwap</a> is the latest project to fall victim, getting rekt across six chains for a total loss of over $48M.</strong></p><p>The project’s concentrated liquidity protocol, KyberSwap Elastic, saw its <a href="https://defillama.com/protocol/kyberswap-elastic">TVL fall</a> from $71M to under $3M. The losses were <a href="https://twitter.com/AnciliaInc/status/1727469857212682470/photo/1">spread out</a> as follows: &gt;$20M on Arbitrum, $15M on Optimism, $7.5M on Ethereum, $3M on Polygon, $2M on Base and $23k on Avalanche.</p><p>This incident brings the total stolen this month to over $300M (<em>so far</em>), including <a href="https://rekt.news/poloniex-rekt/">Poloniex</a> ($126M), <a href="https://rekt.news/dydx-rekt/">dYdX</a> ($8M), <a href="https://rekt.news/kronos-rekt/">Kronos Research</a> ($26M), <a href="https://rekt.news/heco-htx-rekt/">HECO Bridge and HTX</a> ($99M).</p><p><a href="https://twitter.com/spreekaway/status/1727462694138024249">Spreek</a> spotted the hack, which was confirmed within the hour by <a href="https://twitter.com/KyberNetwork/status/1727475235342217682">KyberNetwork</a>:</p><blockquote><p>As a precautionary measure, we strongly advise all users to promptly withdraw their funds. Our team is diligently investigating the situation, and we commit to keeping you informed with regular updates.</p></blockquote><p><strong>Honestly, given that the hacker basically left <a href="https://twitter.com/fozzydiablo/status/1727475573276991766">on-chain instructions</a>, it’s probably <a href="https://twitter.com/spreekaway/status/1727467130189205592">best to withdraw</a> from any KyberSwap forks, in case of black hat copycats.</strong></p><p>As well as playing the Bob Ross of smart contract exploiting, the hacker has some <a href="https://arbiscan.io/tx/0xd5ec02f4fb46ed2c6b030fd5c310f68505295fe1ea8745e532568cc47f7eb8c5">shady</a> connections, but nonetheless <a href="https://etherscan.io/tx/0x7a8912583520304ce2364fa165dafe94461a91ab2dcf45dab942e296594dc40a">claims</a> to be keen to negotiate (<em>after a nap, of course</em>).</p><p><em>Is this an exhausted grey hat, inspired by a <a href="https://cointelegraph.com/news/kyberswap-announces-potential-vulnerability-tells-lps-to-withdraw-asap">near-miss</a> of a <a href="https://twitter.com/TheDEFIac/status/1727618390431306144">similar</a> (albeit <a href="https://twitter.com/1_00_proof/status/1727625974911791488">simpler</a>) <a href="https://100proof.org/kyberswap-post-mortem.html">vulnerability</a>, and finally looking to secure a bounty after over six months of work?</em></p><p><em>Or just a bluffing troll?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/09/rekt-investigates-linebreak.png"/></figure></p><p>Credit: <em><a href="https://twitter.com/0xdoug/status/1727613541115429314">0xdoug</a>, <a href="https://twitter.com/BlockSecTeam/status/1727560157888942331">BlockSec</a></em></p><p><strong>The attack, which <a href="https://etherscan.io/tx/0x485e08dc2b6a4b3aeadcb89c3d18a37666dc7d9424961a2091d6b3696792f0f3">began</a> shortly before 11 PM UTC last night, targeted <a href="https://docs.kyberswap.com/liquidity-solutions/kyberswap-elastic">KyberSwap Elastic</a> (concentrated liquidity) pools.</strong></p><p>The <a href="https://twitter.com/0xdoug/status/1727613541115429314">exploit</a> involved using flash loans to push asset prices into a region of each pool’s liquidity curve where there was no existing liquidity. Then, by executing <a href="https://twitter.com/0xdoug/status/1727615177766387853">extremely precise</a> swaps within this region, the exploiter was able to trick Kyber’s code via a precision error.</p><blockquote><p>That shows just how carefully engineered this exploit was. The check failed by &lt;0.00000000001%</p></blockquote><p><em>See 0xdoug’s detailed breakdown <a href="https://twitter.com/0xdoug/status/1727613541115429314">here</a>.</em></p><p><strong><a href="https://twitter.com/BlockSecTeam/status/1727560157888942331">BlockSec</a> defined the route cause as “<em>tick manipulation and double liquidity counting</em>”:</strong></p><blockquote><p>In summary, the attackers borrowed a flash loan and drained the pools with low liquidity. By executing swaps and altering positions, they manipulated the current prices and ticks of the victimized pools. Ultimately, the attacker triggered multiple swap steps and cross tick operations, resulting in double liquidity counting and consequently draining the pools.</p></blockquote><p>Exploiter address 1 (<a href="https://arbiscan.io/address/0x50275e0b7261559ce1644014d4b78d4aa63be836">ARB</a>, <a href="https://optimistic.etherscan.io/address/0x50275e0b7261559ce1644014d4b78d4aa63be836">OP</a>, <a href="https://etherscan.io/address/0x50275e0b7261559ce1644014d4b78d4aa63be836">ETH</a>, <a href="https://polygonscan.com/address/0x50275e0b7261559ce1644014d4b78d4aa63be836">MATIC</a>, <a href="https://basescan.org/address/0x50275e0b7261559ce1644014d4b78d4aa63be836">BASE</a>, <a href="https://snowtrace.io/address/0x50275e0b7261559ce1644014d4b78d4aa63be836">AVAX</a>): <strong>0x50275e0b7261559ce1644014d4b78d4aa63be836</strong></p><p>Exploiter address 2 (<a href="https://arbiscan.io/address/0xc9b826bad20872eb29f9b1d8af4befe8460b50c6">ARB</a>, <a href="https://optimistic.etherscan.io/address/0xc9b826bad20872eb29f9b1d8af4befe8460b50c6">OP</a>, <a href="https://etherscan.io/address/0xc9b826bad20872eb29f9b1d8af4befe8460b50c6">ETH</a>, <a href="https://polygonscan.com/address/0xc9b826bad20872eb29f9b1d8af4befe8460b50c6">MATIC</a>, <a href="https://basescan.org/address/0xc9b826bad20872eb29f9b1d8af4befe8460b50c6">BASE</a>, <a href="https://snowtrace.io/address/0xc9b826bad20872eb29f9b1d8af4befe8460b50c6">AVAX</a>): <strong>0xc9b826bad20872eb29f9b1d8af4befe8460b50c6</strong></p><p>Example attack tx (ETH): <a href="https://etherscan.io/tx/0x485e08dc2b6a4b3aeadcb89c3d18a37666dc7d9424961a2091d6b3696792f0f3">0x485e08dc…</a></p><p><strong>The attacker used the 0x50275 address for execution and 0xc9b82 address for holding stolen funds across all affected chains. BlockSec’s MetaSleuth <a href="https://twitter.com/MetaSleuth/status/1727568517443252582">provided a map</a> of all the attacks. EigenPhi <a href="https://twitter.com/EigenPhi/status/1727660593027674243">published a list</a> of all transactions.</strong></p><p><em>Although the hacker also <a href="https://scrollscan.com/address/0x50275e0b7261559ce1644014d4b78d4aa63be836">funded</a> their address on Scroll, the attack never went ahead.</em></p><p>Initial funding came from Tornado Cash on Ethereum (via an <a href="https://etherscan.io/address/0x5e42dd64266c3852cad3d294f71b171459cf0a48#internaltx">intermediary address</a>), which in turn funded the ARB, OP, BASE and (unused) Scroll addresses. <a href="https://polygonscan.com/tx/0x97bbc29dca45fea09e27f67cfcce6eda739cbb9c2a3b0e82693642d4df51ed17">MATIC</a> and <a href="https://snowtrace.io/tx/0x736accbc8c4f8e325a36af9c699d385f95a0757b744573e43262d6847dd6c416">AVAX</a> funding came from FixedFloat.</p><p><em>According to <a href="https://docs.kyberswap.com/reference/audits">KyberSwap’s docs</a>, the current version of Elastic had been audited by <a href="https://chainsecurity.com/security-audit/kyberswap-elastic/">ChainSecurity</a> and via a <a href="https://audits.sherlock.xyz/contests/103">Sherlock contest</a>.</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p>The exploiter clearly has on-chain flair, showing their working via <a href="https://etherscan.io/tx/0x485e08dc2b6a4b3aeadcb89c3d18a37666dc7d9424961a2091d6b3696792f0f3#eventlog">tx event logs</a> throughout the attack, leaving charming comments such as “<em>Step 2, finding liquidity required</em>”, “<em>Is it enough?</em>” and “<em>Raping Now</em>”.</p><p><strong>They also <a href="https://arbiscan.io/tx/0xd5ec02f4fb46ed2c6b030fd5c310f68505295fe1ea8745e532568cc47f7eb8c5">sent 1000 ETH</a> on Arbitrum to an address <a href="https://etherscan.io/address/0x84e66f86c28502c0fc8613e1d9cbbed806f7adb4">associated</a> with the <a href="https://rekt.news/indexed-finance-rekt/">$16M hack of Indexed Finance</a> in October 2021.</strong></p><p>While this may be simple misdirection, the move <em>does</em> sound <a href="https://twitter.com/Mudit__Gupta/status/1727618570232934700">plausibly</a> like the actions of the Indexed hacker, limelight-loving Andean Medjedovic, who has <a href="https://www.dlnews.com/articles/people-culture/andean-medjedovic-canadian-fugitive-hacker-code-is-law-whitehat/">previous</a> in being performatively offensive.</p><p>The timing is also strange, given the recent (thwarted) governance <a href="https://twitter.com/functi0nZer0/status/1725922016484597975">attack</a> on Indexed Finance’s abandoned treasury. While the fallout is <a href="https://twitter.com/functi0nZer0/status/1727498381440762003">ongoing</a>, the initial attempt appears <a href="https://twitter.com/zachxbt/status/1726002049123340666">linked to Lazarus</a>.</p><p><strong>However, while <a href="https://twitter.com/tayvano_/status/1727384134061052410">many recent hacks</a> have <a href="https://rekt.news/big-phish/">Lazarus</a> written all over them, this incident looks different.</strong></p><p><em>Candid on-chain easter-eggs and attempts at misdirection aren’t Lazarus’ style; they don’t waste time planting red-herrings.</em></p><p>Instead, they opt to work openly, relying on <a href="https://twitter.com/tayvano_/status/1668935273047261185">complex webs</a> of transactions to bore and confuse investigators, or throw them off the scent.</p><p><em>And if it were Lazarus, they certainly wouldn’t be looking to negotiate…</em></p><p><strong>Whoever the hacker may turn out to be, it appears that all hope is not lost.</strong></p><p>The the following <a href="https://etherscan.io/tx/0x7a8912583520304ce2364fa165dafe94461a91ab2dcf45dab942e296594dc40a">on-chain message</a> was sent from the exploiter’s address upon completion of the attack:</p><blockquote><p>Dear Kyberswap Developers, Employees, DAO members and LPs,</p><p>Negotiations will start in a few hours when I am fully rested.</p><p>Thank you.</p></blockquote><p><strong>Perhaps there’s some good news in store for KyberSwap and LPs.</strong></p><p><em>Or is the attacker just toying with us all?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/rekt-outline-conc.png"/></figure></p>