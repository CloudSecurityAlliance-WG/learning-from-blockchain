<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2023/01/eralend-header.png"/></figure></p><p><em>One more added to the list.</em></p><p><strong>Yesterday, <a href="https://twitter.com/Era_Lend">EraLend</a>, a lending platform on zkSync Era, lost $3.4M to the rampant read-only reentrancy bug plaguing protocols across the cryptosphere.</strong></p><p>The <a href="https://twitter.com/spreekaway/status/1683817944470396928">alarm was raised</a> and the losses <a href="https://twitter.com/spreekaway/status/1683822041844027393">stacked up</a>. Syncswap was <a href="https://twitter.com/syncswap/status/1683831056015949826">keen to reassure</a> their users that they were not at risk, though recommended pulling LP tokens from EraLend as a precaution. In the end, only USDC deposits on EraLend were affected.</p><p>This is the second <a href="https://rekt.news/leaderboard/">leaderboard</a> entry to come from zkSync, after <a href="https://rekt.news/merlin-dex-rekt/">Merlin DEX</a>’s $1.8M rugpull in April.</p><p><em>With hack szn hotting up, where will be hit next?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/09/rekt-investigates-linebreak.png"/></figure></p><p>Credit: <em><a href="https://twitter.com/spreekaway/status/1683823980816236545">Spreekaway</a>, <a href="https://twitter.com/peckshield/status/1683830339637219328">Peckshield</a></em></p><p><em>Read-only reentrancy is nothing new, with last Friday’s attack on <a href="https://rekt.news/conic-finance-rekt/">Conic Finance</a> the latest in a long line of projects rekt by the issue.</em></p><p><strong>In EraLend’s case, the attacker was able to exploit the vulnerability via a callback when burning LP tokens.</strong></p><blockquote><p>in the syncswap LP tokens, one can burn, then callback before update_reserves is called. so the oracle uses an incorrect reserves value to calculate the price, resulting in an inflating oracle price.</p></blockquote><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2023/01/eralend-code.png"/></figure></p><p>The buggy code was recycled from SyncSwap, but improperly implemented. Astonishingly, the code even contained the comment pointing out the potentially risky routine, which was apparently ignored:</p><blockquote><p>Note reserves are not updated at this point to allow read the old values.</p></blockquote><p><strong>But comments are <a href="https://twitter.com/pcaversaccio/status/1683860327778209792">not effective reentrancy protection</a>.</strong></p><p>Exploiter address: <strong><a href="https://explorer.zksync.io/address/0xf1D076c9Be4533086f967e14EE6aFf204D5ECE7a">0xf1D076c9Be4533086f967e14EE6aFf204D5ECE7a</a></strong></p><p>Example attack txs: <a href="https://explorer.zksync.io/tx/0x7ac4da1ea1b0903dfabda56f713ea5e4a960a3fc34467a844d037f86ee8bfe98">0x7ac4da1e…</a>, <a href="https://explorer.zksync.io/tx/0x99efebacb3edaa3ac34f7ef462fd8eed85b46be281bd1329abfb215a494ab0ef">0x99efebac…</a></p><p><em>Of the $3.4M lost from EraLend, <a href="https://twitter.com/hackenclub/status/1684154146356871168">Hacken</a> puts the attacker profits at around $2.66M and traced funds to addresses on ETH, ARB and OP.</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p><strong>BlockSec tweeted a <a href="https://twitter.com/BlockSecTeam/status/1683830744961912832">warning</a> to other projects that may be using the same code:</strong></p><blockquote><p>Alert! All projects that rely on the following Syncswap code need to be vigilant.</p></blockquote><p><em>But given the prevalence of this attack type over the last months, why haven’t all devs already double (or triple) checked by now?</em></p><p>Peckshield, who <a href="https://github.com/peckshield/publications/blob/master/audit_reports/PeckShield-Audit-Report-Nexon-v1.0.pdf">audited</a> EraLend (then Nexon Finance) in March, washed their hands of responsibility. The audit <a href="https://twitter.com/pcaversaccio/status/1683860794084036611">apparently</a> “<em>assumes a trusted price oracle</em>”, simplifying their job by simply ignoring one of the trickiest and most exploitable parts of many DeFi protocols.</p><p>As <a href="https://www.youtube.com/live/9eyKxfC_EcA?feature=share&amp;t=1162">noted</a> by ChainSecurity’s Matthias Egli at EthCC last week, the losses from this string of hacks is far lower than the potential losses from far larger protocols that had been vulnerable before the vector was <a href="https://chainsecurity.com/curve-lp-oracle-manipulation-post-mortem/">discovered</a> last year.</p><p><strong>But that silver lining likely doesn’t make much difference to EraLend users.</strong></p><p><em>How long until this bug strikes again?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/rekt-outline-conc.png"/></figure></p>