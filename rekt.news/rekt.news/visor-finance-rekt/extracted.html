<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/12/visor-header.png"/></figure>
<strong>It is the season of giving, and Visor Finance is going all in.</strong></p><p><a href="https://www.visor.finance/">Visor</a> allowed certain contracts to mint unlimited rewards.</p><p>Yesterday an anonymous actor took advantage of this gift, and withdrew 8.8M VISR from the platform, worth $8.2M at pre-hack prices.</p><p><strong>However, the hacker suffered when dumping VISR via Uniswap’s VISR-ETH pool.</strong></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/12/visor-priceimpact.png"/></figure></p><p><strong>-87%</strong></p><blockquote><p>rekt.</p></blockquote><p>Back in June, Visor, a liquidity management protocol for <a href="https://rekt.news/uniswap-v3-lp-rekt/">Uni v3</a>, downplayed the loss of $500k (of its then $3M TVL) in a <a href="https://visorfinance.medium.com/visor-beta-incident-report-1b2521b9266">security breach.</a></p><p>Then, last month, the project fell victim to what the Visor team defensively <a href="https://twitter.com/VisorFinance/status/1464574917056385025">claimed</a> was “<em>economic arbitrage</em>”.</p><p><strong>Does “<em><a href="https://twitter.com/Mudit__Gupta/status/1464657484367339527">reliance on spot prices for issuing shares</a></em>” not count as a smart contract bug?…</strong></p><p><em>What was it this time?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/09/rekt-investigates-linebreak.png"/></figure></p><p><strong>Hacker’s address:</strong> <a href="https://etherscan.io/address/0x8efab89b497b887cdaa2fb08ff71e4b3827774b2">0x8efab89b497b887cdaa2fb08ff71e4b3827774b2</a></p><p><a href="https://etherscan.io/tx/0x660b97542ade1e533bd5e098dbe53da26b63d53a3c2c4dd46b481a91bd075ead">Funded</a> by Tornado Cash a few mins before the <a href="https://etherscan.io/tx/0x69272d8c84d67d1da2f6425b339192fa472898dce936f24818fda415c1c1ff3f">execution</a> of the attack.</p><p>Due to a vulnerable <em>require()</em> check in the <a href="https://etherscan.io/address/0xc9f27a50f82571c1c8423a42970613b8dbda14ef#code">vVISR Rewards Contract</a>’s <em>deposit()</em> function, the hacker was able to mint unlimited shares using their own <a href="https://etherscan.io/address/0x10c509aa9ab291c76c45414e7cdbd375e1d5ace8">contract.</a></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/12/visor-code.png"/></figure></p><p><strong>As long as the hacker passes their own contract as “<em>from</em>” and the contract has an <em>Owner()</em> method of <em>msg.sender</em>, then they can mint as many shares as they want to any address using <em>vvisr.mint()</em>.</strong></p><p><em>Credit: <a href="https://twitter.com/storming0x/status/1473321779250802693">@storming0x</a></em></p><p><strong>The attacker <a href="https://etherscan.io/tx/0x27f2210536553392cf180c0b37055b3dc92094a5d585d7d2a51f790c9145e47c">transferred ownership</a> of the contract to its own address, before executing the exploit transaction, <a href="https://etherscan.io/tx/0x69272d8c84d67d1da2f6425b339192fa472898dce936f24818fda415c1c1ff3f">minting</a> 195k vVISR tokens.</strong></p><p>These were then <a href="https://etherscan.io/tx/0x6eabef1bf310a1361041d97897c192581cd9870f6a39040cd24d7de2335b4546">burned</a> for 8.8M VISR before being swapped via Uniswap v2 for ETH and washed via Tornado Cash in <a href="https://etherscan.io/tx/0x0e16210218ecc487a35b9ff48fe3d9f3e9b0f50330f9e7805e38135732b85270">this</a> and 6 subsequent transactions totalling 113 ETH ($450k) so far.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p><strong>In their <a href="https://medium.com/visorfinance/post-mortem-for-vvisr-staking-contract-exploit-and-upcoming-migration-7920e1dee55a">official post-mortem</a>, Visor has proposed a <a href="https://twitter.com/VisorFinance/status/1473317327601078279">token migration</a> based on a snapshot before the exploit.</strong></p><p>They also state that:</p><p>“<em>We are engaged with both Quantstamp and ConsenSys Diligence for December and January <a href="https://docs.visor.finance/learn/audits">audits</a> and this new staking contract will be included.</em>”</p><p>As the users are to be refunded, it seems the only damage done is to the reputation of the Visor team.</p><p><strong>At least they are gaining experience in post-hack PR…</strong></p><p>As <a href="https://twitter.com/BlockSecTeam/status/1473343144620015619">BlockSec</a> wrote on Twitter:</p><blockquote><p>“Since last time an attack was called arbitrage, can we call it an airdrop this time?”</p></blockquote><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/rekt-outline-conc.png"/></figure></p>