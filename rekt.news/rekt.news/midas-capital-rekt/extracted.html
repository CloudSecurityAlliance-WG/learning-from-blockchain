<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2023/01/midas-header.png"/></figure></p><p><strong>The <a href="https://midascapital.xyz/">Midas</a> touch has backfired, leaving a $660K hole in one of its pools of <a href="https://twitter.com/Jarvis_Network">Jarvis Network</a>’s jFIAT assets.</strong></p><p><em>On Sunday, Polygon-based lending protocol Midas Capital was exploited via a flash loan attack on a recently-added collateral type.</em></p><p><a href="https://twitter.com/MidasCapitalxyz/status/1614774901247991808">Both</a> <a href="https://twitter.com/Jarvis_Network/status/1614723934519234560">organisations</a> announced the cause of the attack as the use of WMATIC-stMATIC Curve LP token. The read-only reentrancy vulnerability is a known weakness of this type of LP token, and had <a href="https://quillaudits.medium.com/decoding-220k-read-only-reentrancy-exploit-quillaudits-30871d728ad5">previously</a> led to a $220k loss on <a href="https://www.market.xyz/">market.xyz</a> in October.</p><p><em>All that glitters is not gold…</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/09/rekt-investigates-linebreak.png"/></figure></p><p>Credit: <em><a href="https://twitter.com/BlockSecTeam/status/1614864084956254209">BlockSec</a>, <a href="https://twitter.com/BeosinAlert/status/1614905399102287872">Beosin</a></em></p><p>Midas recently added WMATIC-stMATIC Curve LP token for use as collateral. These tokens have a read-only reentrancy <a href="https://chainsecurity.com/curve-lp-oracle-manipulation-post-mortem/">vulnerability</a> which allows the token's virtual price to be manipulated when improperly implemented.</p><p><strong>According to BlockSec’s <a href="https://twitter.com/BlockSecTeam/status/1614864084956254209">analysis</a> the attack has 5 basic steps:</strong></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2023/01/midas-steps.png"/></figure></p><blockquote><ol><li><p>the calculation of a position's collateral depends on self.D and totalSupply</p></li><li><p>self.D is updated after an unexcepted callback, so the four borrows in step 5 to use an outdated self.D.</p></li><li><p>the contract burns stMATIC-f before the unexcepted callback, which causes the four borrows in step 5 to use an updated <code>stMATIC-f.totalSupply()</code>.</p></li></ol><p>As a result, <a href="https://twitter.com/MidasCapitalxyz">@MidasCapitalxyz</a> over-estimated the attack contract's position and lent excessive assets to the contract.</p></blockquote><p><strong>Attacker address:</strong> <a href="https://polygonscan.com/address/0x1863b74778cf5e1c9c482a1cdc2351362bd08611">0x1863b74778cf5e1c9c482a1cdc2351362bd08611</a></p><p><strong>Attack tx:</strong> <a href="https://polygonscan.com/tx/0x0053490215baf541362fc78be0de98e3147f40223238d5b12512b3e26c0a2c2f">0x00534902…</a></p><p><strong>Attacked smart contract:</strong> <a href="https://polygonscan.com/address/0x5bca7ddf1bcccb2ee8e46c56bfc9d3cdc77262bc#code">0x5bca7ddf1bcccb2ee8e46c56bfc9d3cdc77262bc</a></p><p>The attacker was able to borrow the <a href="https://twitter.com/StfnTdrv/status/1614942921609945088">following</a> assets against the inflated collateral:</p><p>jCHF: 273,973</p><p>jEUR: 368,058</p><p>jGBP: 45,250</p><p>agEUR: 45,435</p><p><strong>Which were then swapped to ~660k MATIC ($660k) and sent on to Kucoin and Binance.</strong></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p><strong>It’s always a shame to report on losses in DeFi, but especially when they are down to already <a href="https://twitter.com/BeosinAlert/status/1614905406039658496">known</a> issues, with simple <a href="https://twitter.com/CurveFinance/status/1614939752507244544">workarounds</a>.</strong></p><p>Jarvis Network will <a href="https://twitter.com/pscltllrd/status/1614924762547122176">cover</a> the (~$350k) shortfall in backing of jFIATs that resulted from the exploit, and Midas Capital have reached out to the hacker in an <a href="https://twitter.com/MidasCapitalxyz/status/1614977157561987072">attempt</a> to negotiate a bounty.</p><p>In a statement to rekt.news, Jarvis Network's founder <a href="https://twitter.com/pscltllrd">Pascal Tallarida</a> explained how they plan to deal with the incident going forward:</p><blockquote><p>As a result of the Midas exploit, the protocol lost 257k jEUR, 237k jCHF and 45k jGBP, and users lost 111k jEUR and 36k jCHF. The jFIATs belonging to the protocol were not collateralized.</p><p>We have decided to do not wait after Midas, and we are working on a plan to re-collateralize the jFIATs the protocol lost, and reimburse the users who were victim of the exploit. We will propose to the Jarvis governance to allocate part of the protocol’s revenus (liquidity provision, lending interests, protocol fee and farming with POL) and part of the protocol treasury to it, and we will ask for the help and support of our community, partners, investors, and “frens”. I have already discussed with many of them and they have expressed their will to support us in this difficult moment, either with or without counterparty. Also, the company which is the main liquidity provider within the protocol, will help, with both its treasury and revenues (±$700k last year with swap fees, interests and market making).</p><p>Then, Midas promised us that they will do right by us, by reimbursing what they can, and by helping us to provide value to the protocol. It could take them a while to do so, but I trust that they will do it.</p></blockquote><p>This isn’t the first time we have seen a hastily incorporated collateral type leading to a loss, and is unlikely to be the last.</p><p><strong>Let’s hope this rushed decision doesn’t prove to be Midas’ <a href="https://penelope.uchicago.edu/Thayer/E/Roman/Texts/Claudian/In_Rufinum/1*.html">undoing</a> this time…</strong></p><p><em>"His senses are captured by the bait, and, thrilled beyond measure, he feasts his greedy eyes on the sight. So Midas, king of Lydia, swelled at first with pride when he found he could transform everything he touched to gold: but when he beheld his food grow rigid and his drink harden into golden ice then he understood that this gift was a bane and in his loathing for gold cursed his prayer."</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/rekt-outline-conc.png"/></figure></p>