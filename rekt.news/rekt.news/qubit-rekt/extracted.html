<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2022/01/qubit-header.png"/></figure></p><p><strong>In other news…</strong></p><p><a href="https://qbt.fi/">Qubit Finance</a>, a BSC-based lending protocol <a href="https://pancakebunny.medium.com/introducing-qubit-qbt-innovating-lending-and-borrowing-on-the-bsc-9f3fe6438f44">launched</a> by the team behind <a href="https://rekt.news/pancakebunny-rekt/">repeat</a> <a href="https://rekt.news/pancakebunny2-rekt/">offender</a> PancakeBunny, has fallen victim to an $80M exploit.</p><p>That’s number seven on <a href="https://rekt.news/leaderboard/">our leaderboard</a>.</p><p><em>But will anyone remember this next week?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/09/rekt-investigates-linebreak.png"/></figure></p><p>Qubit allows for <a href="https://docs.qbt.fi/protocol/bridge">cross-chain collateralisation</a>, locking assets on Ethereum to borrow against on BSC via the QBridge deposit function.</p><p>The attacker took advantage of a logic bug in the code which made xETH available for use on BSC without having deposited ETH on Ethereum.</p><p>The attacker’s Ethereum <a href="https://etherscan.io/address/0xd01ae1a708614948b2b5e0b7ab5be6afa01325c7">address</a> was <a href="https://etherscan.io/tx/0x8d2e9fd13c3e3f59eac17ff55bb0a0b10eee965a2e768e60832b1b3d5b80ebfb">funded</a> from Tornado Cash shortly before the exploit commenced at approximately 21:30 PM +UTC on January 27th 2022.</p><p>From the Qubit team’s <a href="https://medium.com/@QubitFin/protocol-exploit-report-305c34540fa3">post-mortem</a>:</p><p><strong>1.</strong> The attacker called the QBridge deposit function on the ethereum network, which calls the deposit function QBridgeHandler.</p><p><strong>2.</strong> QBridgeHandler should receive the WETH token, which is the original tokenAddress, and if the person who performed the tx does not have a WETH token, the transfer should not occur.</p><p><strong>3.</strong> tokenAddress.safeTransferFrom(depositer, address(this), amount);</p><p><strong>4.</strong> In the code above, tokenAddress is 0, so safeTransferFrom didn’t fail and the deposit function ended normally regardless of the amount value.</p><p><strong>5.</strong> Additionally, tokenAddress was the WETH address before depositETH was added, but as depositETH is added, it is replaced with the zero address that is the tokenAddress of ETH.</p><p><strong>6.</strong> In summary, the deposit function was a function that should not be used after depositETH was newly developed, but it remained in the contract.</p><p>According to Certik’s <a href="https://certik.medium.com/qubit-bridge-collapse-exploited-to-the-tune-of-80-million-a7ab9068e1a0">analysis</a>:</p><blockquote><p><em>One of the root causes of the vulnerability was the fact that tokenAddress.safeTransferFrom() does not revert when the tokenAddress is the zero (null) address (0x0…000).</em></p></blockquote><p>Despite not having locked any ETH in the Ethereum contract, the attacker’s BSC address now had access to <a href="https://bscscan.com/tx/0x50946e3e4ccb7d39f3512b7ecb75df66e6868b9af0eee8a7e4b61ef8a459518e">77,162 qXETH</a> ($185 million) to use as collateral against loans on Qubit.</p><p>They used this collateral to borrow WETH, BTC-B, USD stablecoins, and CAKE, BUNNY, and MDX before swapping everything for a total of 200k BNB (~$80M), which remains in the <a href="https://bscscan.com/address/0xd01ae1a708614948b2b5e0b7ab5be6afa01325c7">BSC address</a>.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p><strong>According to the Qubit docs, the cross-chain collateral feature was audited in Dec 2021.</strong></p><blockquote><p><em>the whole X-Collateral feature (including contracts and scripts) has been audited by Theori, a professional auditing firm. The audit result is published <a href="https://github.com/PancakeBunny-finance/qubit-finance/blob/master/audits/mound_qubit_xChain_audit_rev1.1.pdf">here</a>.</em></p></blockquote><p>The project has a max bounty of $250k on <a href="https://immunefi.com/bounty/qubit/">Immunefi</a>, but the Qubit team seems prepared to <a href="https://twitter.com/QubitFin/status/1486984216072318977">negotiate</a>.</p><p>Back in May 2021, we were <a href="https://twitter.com/RektHQ/status/1397195892327858181">gifted</a> 100k DAI by the Pancake Bunny hacker.</p><p>We returned the funds, and <a href="https://twitter.com/RektHQ/status/1399714766785028098?s=20">told</a> the team “not to lose it this time”, yet here we are again.</p><p>Our donation address is listed below.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/7/pancbunny2-conc.png"/></figure></p>