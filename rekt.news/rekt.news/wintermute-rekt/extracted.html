<section class="post-content"><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2022/05/optiwintermute-header.png"/></figure></p><p><strong>The glass is half-empty for <a href="https://www.wintermute.com/">Wintermute</a> who have lost 20M OP, worth ~$27.6M at the time of the incident.</strong></p><p>The funds were supposed to be sent to Wintermute by the Optimism Foundation in an agreement to act as a market maker ahead of the OP token launch.</p><p><strong>But Wintermute provided the address of their <a href="https://etherscan.io/address/0x4f3a120e72c76c22ae802d129f599bfdbc31cb81">multisig on Ethereum</a> as the <a href="https://optimistic.etherscan.io/address/0x4f3a120e72c76c22ae802d129f599bfdbc31cb81">destination address</a> on Optimism - an address they did not control.</strong></p><p>According to the Optimism Foundation’s <a href="https://plaid-cement-e44.notion.site/A-Message-to-the-Community-from-the-Optimism-Foundation-f49b913bb0974d8a854a8bdd409a9dd6">announcement</a>, Wintermute then confirmed receipt of two test transactions, firstly for <a href="https://optimistic.etherscan.io/tx/0xf79ed3037b55fbfd305007da2f19fb7960d31b8410453c679313e37a6d8548f4">1 OP</a> and then for <a href="https://optimistic.etherscan.io/tx/0x0c1d6166293924566ea0ca32d07379c7033a8b8f2558f667f917543e51dd474a">1M OP</a>, without checking that they had access to the funds.</p><p>The remaining <a href="https://optimistic.etherscan.io/tx/0x8e29eef359f6c18a06e229157d44467b5e873f6e5b996baa7124b38eb6dfb1db">19M OP</a> were sent shortly after the second test transaction on the 27th May.</p><p>According to Wintermute’s <a href="https://gov.optimism.io/t/message-to-optimism-community-from-wintermute/2595">statement</a>, they notified the Optimism Foundation about their error on 30th May.</p><p>The OP launch went ahead regardless on the 1st of June, despite almost 10% of the soon-to-be circulating supply being up for grabs.</p><p><strong>An opportunistic anon seized control of the ownerless funds on 5th June.</strong></p><p><em>How did the exploiter gain access?</em></p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/09/rekt-investigates-linebreak.png"/></figure></p><p><em>Credit: <a href="https://twitter.com/yoavw/status/1534699457400520704">yoav.eth</a>, <a href="https://twitter.com/kelvinfichter/status/1534636743223386119">kelvinfichter</a>, <a href="https://mirror.xyz/banteg.eth/iZAsBNL3j_5NIAY2Erav1r7Q4ecc7SC76AfMjyScs34">banteg</a></em></p><p>Once the tokens had been sent, they were sitting out in the open, ready to be taken by anyone who spotted them…</p><p>The hint was the fact that the address corresponded to a Gnosis Safe proxy on mainnet, but had no contract deployed to the Optimism address.</p><p>Nobody could take control of the address as an EOA, that would require the private key.</p><p><strong>However, there was a way to access the funds; anyone could take control of the address by deploying a Gnosis Safe proxy to it.</strong></p><p><em>This is <a href="https://help.gnosis-safe.io/en/articles/5267779-i-sent-assets-to-a-safe-address-on-the-wrong-network-any-chance-to-recover">not an easy task</a>, however.</em></p><p>Wintermute <a href="https://gov.optimism.io/t/message-to-optimism-community-from-wintermute/2595">state</a> that:</p><blockquote><p>After consulting with the Optimism and Safe teams, Wintermute made the assessment that the funds were potentially retrievable, and that nobody other than Wintermute could recover those funds. The assessment was also that it was a high risk retrieval that could only be attempted once and required Safe to support. Retrieval was scheduled for 7th of June. <strong>However, the assumption that the funds can only be recoverable by Wintermute proved to be false.</strong></p></blockquote><p>As Wintermute’s Gnosis Safe on mainnet had been <a href="https://etherscan.io/tx/0xd705178d68551a6a6f65ca74363264b32150857a26dd62c27f3f96b8ec69ca01#eventlog">created</a> back in 2020, it was deployed using an old version of the <a href="https://etherscan.io/address/0x76e2cfc1f5fa8f6a5b3fc4c8f4788f0116861f9b#code">ProxyFactory contract</a>, which includes the out-of-date <em>create</em> opcode, rather than <em>create2</em>.</p><p>With <em>create</em>, the deployed proxy address depends only on the ProxyFactory’s address and nonce. This meant that the exploiter could replay deployments on Optimism (setting themself as owner) until the nonce matched the original mainnet deployment and a matching proxy address was created.</p><p>This was eventually achieved after running batched deployments of 162 safes at a time, until the matching address was created in <a href="https://optimistic.etherscan.io/tx/0x00a3da68f0f6a69cb067f09c3f7e741a01636cbc27a84c603b468f65271d415b#eventlog">this transaction</a>.</p><p><a href="https://optimistic.etherscan.io/address/0x8BcFe4f1358E50A1db10025D731C8b3b17f04DBB">Exploiter’s address</a>, used to create the adapted <a href="https://optimistic.etherscan.io/address/0xe7145dd6287ae53326347f3a6694fcf2954bcd8a">ProxyFactory contract</a>, which was <a href="https://optimistic.etherscan.io/tx/0x06cbffe3dcbf9405f5b50aafbdec542cfaeecaeed580c3cc51a0604e423f91eb">funded</a> by Tornado Cash on the 1st June.</p><p><strong>Wintermute’s multisig on Ethereum: <a href="https://etherscan.io/address/0x4f3a120e72c76c22ae802d129f599bfdbc31cb81">0x4f3a120e72c76c22ae802d129f599bfdbc31cb81</a></strong></p><p><strong>Hijacked address on Optimism: <a href="https://optimistic.etherscan.io/address/0x4f3a120e72c76c22ae802d129f599bfdbc31cb81">0x4f3a120e72c76c22ae802d129f599bfdbc31cb81</a></strong></p><p>So far, <a href="https://optimistic.etherscan.io/tx/0x230e17117986f0dc7259db824de1d00c6cf455c925c0c8c6b89bf0b6756a7b7e">1M OP</a> has been sent to the <a href="https://optimistic.etherscan.io/address/0x60b28637879b5a09d21b68040020ffbf7dba5107">exploiter’s EOA</a> and <a href="https://optimistic.etherscan.io/tx/0xe9491bfb9a1ad13a47f3c1f61197b097416cbed2e32e038dd3de97172ddee303">sold</a> for 720 ETH, and a further 1M OP was <a href="https://optimistic.etherscan.io/tx/0xdb693613d550e38d53d47b5fd07ce505e24e141db146fa1321710c9a86d9db6a">sent</a> to Vitalik’s address.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/03/rekt-linebreak.png"/></figure></p><p>The exploiter’s timing is interesting, as pointed out by <a href="https://twitter.com/yoavw/status/1534699845147152384">yoav.eth</a>:</p><blockquote><p><a href="https://optimistic.etherscan.io/address/0x8bcfe4f1358e50a1db10025d731c8b3b17f04dbb#internaltx">Funded</a> via Tornado 7 days ago</p><p>Then deployed the contract, waited 4 days, and hijacked wintermute's proxy.</p><p>Why wait 4 days?</p></blockquote><p>If they were looking to secure their loot, why give Wintermute the extra time to mount a rescue attempt?</p><p>The remaining 18M OP have not yet been dumped, is this down to a lack of liquidity or does the exploiter intend to return the funds?</p><p><strong><a href="https://gov.optimism.io/t/message-to-optimism-community-from-wintermute/2595">Wintermute</a> aren’t banking on it:</strong></p><blockquote><p>There is hope that it is a whitehat exploit, in which case the remaining funds are potentially recoverable. However we are currently operating under the premise that it is not the case</p></blockquote><p>In the meantime, the Optimism Foundation has provided an <a href="https://twitter.com/optimismPBC/status/1534631773887422465">additional 20M OP</a> to Wintermute to perform their original market making duties.</p><p><strong>Wintermute’s balance sheet aside, there are more wide-reaching concerns raised by this incident.</strong></p><p>Having almost 10% of the OP circulating supply in the hands of a bad actor is potentially dangerous for Optimism’s governance processes, something the Foundation is <a href="https://twitter.com/optimismPBC/status/1534631774936084487">well aware of</a>.</p><p>Should this change, the option of “<em>a network upgrade … to halt the movement of those OP tokens</em>” would set a worrying precedent.</p><p>Although the mistake was <a href="https://twitter.com/0xtroll/status/1531899449512820736">flagged</a> on OP’s launch day, the alert was seemingly ignored by the community. The tweet came hours after the exploiter had funded their address, however, so is unlikely to have been the information to tip-off the incident.</p><p><strong>While <a href="https://twitter.com/optimismPBC/status/1534631772700516352">replacing the 20M OP</a> won’t be a problem for a giant MM such as Wintermute, the carelessness of this incident is alarming.</strong></p><p><em>The funds were sat in an unowned address for 9 days.</em></p><p>In an already struggling market, actions such as these make it hard to remain Optimistic.</p><p><figure><img alt="" src="https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/08/rekt-outline-conc.png"/></figure></p><blockquote><p>If you enjoy our work, please consider donating to our <a href="https://gitcoin.co/grants/1632/rekt-the-dark-web-of-defi-journalism">Gitcoin Grant</a>.</p></blockquote>